<!DOCTYPE html>
<html>
<head>
    <!-- Fun compatability things -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">

    <!-- Information about this site -->
    <title>
        A Flake for your Crate
    </title>
    <meta name="description"
        content="Creating a Nix Flake for your Rust crate." />

    <!-- Various Twitter related content. -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;ed4480597489834f00.jpg" />
    <meta property='og:image' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;ed4480597489834f00.jpg" />
    <meta name="twitter:site" content="@a_hoverbear" />
    <meta name="twitter:creator" content="@a_hoverbear" />
    <link rel="me" href="https:&#x2F;&#x2F;hachyderm.io&#x2F;@ana">

    <meta name="twitter:title"
        content="A Flake for your Crate" />
    <meta property='og:title'
        content="A Flake for your Crate" />

    <meta property='og:url'
        content="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;a-flake-for-your-crate&#x2F;" />

    <meta name="twitter:description"
        content="Nix (PDF) provides users a way to access the massive Nixpkgs library of packages, create reproducable builds of software, roll slim containers, create declarative VMs, or run their whole machines. A new feature of Nix, Flakes, is bringing a convention to how projects like Rust crates can be accessed, integrated, and used within Nix (or NixOS.)
Let&#x27;s explore how we can make our Rust crate usable as a Nix flake. At the end of this, any nix user with Flakes enabled should be able to run your project with something like nix run github:user&#x2F;project. They&#x27;ll be able to add your repository as a Nix overlay, install the package, do interactive builds, or create a portable bundle of it.
" />
    <meta property='og:description'
        content="Nix (PDF) provides users a way to access the massive Nixpkgs library of packages, create reproducable builds of software, roll slim containers, create declarative VMs, or run their whole machines. A new feature of Nix, Flakes, is bringing a convention to how projects like Rust crates can be accessed, integrated, and used within Nix (or NixOS.)
Let&#x27;s explore how we can make our Rust crate usable as a Nix flake. At the end of this, any nix user with Flakes enabled should be able to run your project with something like nix run github:user&#x2F;project. They&#x27;ll be able to add your repository as a Nix overlay, install the package, do interactive builds, or create a portable bundle of it.
" />


    <!-- Talk about the homepage and the rss feed. -->
    <link rel="canonical"
        href="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;a-flake-for-your-crate&#x2F;">
    <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">

    <!-- Stylesheets are fun -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Delius&family=Fira+Code&family=Noto+Sans&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />

    <!-- Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css"
        integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js"
        integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O"
        crossorigin="anonymous"></script>
    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js"
        integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
</head>

<body>
    
<div id="hero-wrapper">
    <figure class="enriched " style="">
       <figcaption>Photo&nbsp;- <a href="https://unsplash.com/photos/Cbo4Bxx7SaA">Ahmed Sobah</a></figcaption>
       

<img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;43c774faf584723200.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;ed4480597489834f00.jpg 3840w
              " sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,set 
                     3840px" src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;43c774faf584723200.jpg" alt="Photo" />
</figure>
</div>
<header>
    <div class="content">
        <h1 id="main-title"><a id="main-link" href="https:&#x2F;&#x2F;hoverbear.org">
                A Flake for your Crate
            </a></h1>

        <nav id="tree">
    <ul>
        <li>
            <a href="https://hoverbear.org/about/">
                Ana, Hoverbear üêª
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/blog/">
                Articles
            </a>&nbsp;
        </li></ul><ul>
        </ul><ul>
        </ul>
</nav>

        <div class="metadata">
            <h5 class="description">
                Creating a Nix Flake for your Rust crate.
            </h5>

            <p class="date">
                Posted on 2021-06-25, around 8 minutes of reading.
            </p>
        </div>
    </div>
</header>

<main>
    
<nav id=toc>
    <ol>
        
        <li>
            <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#prerequisites">Prerequisites</a>
            
            <ol>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#if-using-nixos">If using NixOS:</a>
                </li>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#if-using-nix">If using Nix</a>
                </li>
                
            </ol>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#setup">Setup</a>
            
            <ol>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#flake-nix">flake.nix</a>
                </li>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#default-nix">default.nix</a>
                </li>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#optional-nix-direnv-envrc">Optional: nix-direnv &amp; .envrc</a>
                </li>
                
            </ol>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#make-sure-it-works">Make sure it works</a>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#in-the-real-world">In the real world</a>
            
            <ol>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#ripgrep">ripgrep</a>
                </li>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#bottom">bottom</a>
                </li>
                
                <li>
                    <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#nushell-nu">Nushell (nu)</a>
                </li>
                
            </ol>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/a-flake-for-your-crate/#getting-help">Getting help</a>
            
        </li>
        
    </ol>
</nav>

    <p><a rel="noopener" target="_blank" href="https://edolstra.github.io/pubs/phd-thesis.pdf">Nix (PDF)</a> provides users a way to access the massive <a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs">Nixpkgs</a> library of packages, create reproducable builds of software, roll slim containers, create declarative VMs, or run their whole machines. A new feature of Nix, <em>Flakes</em>, is bringing a convention to how projects like Rust crates can be accessed, integrated, and used within Nix (or NixOS.)</p>
<p>Let's explore how we can make our Rust crate usable as a Nix flake. At the end of this, any <code>nix</code> user with Flakes enabled should be able to run your project with something like <code>nix run github:user/project</code>. They'll be able to add your repository as a <a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Overlays">Nix overlay</a>, install the package, do interactive builds, or create a portable bundle of it.</p>
<span id="continue-reading"></span><h1 id="prerequisites">Prerequisites</h1>
<p>Before we get started, you'll need a Nix with the <code>flakes</code> feature enabled. Let's do that!</p>
<h2 id="if-using-nixos">If using <a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/NixOS">NixOS</a>:</h2>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-comment z-line z-number-sign z-nix"># Use edge NixOS.</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">nix</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">extraOptions</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
    experimental-features = nix-command flakes
  <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">nix</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">package</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nixUnstable</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">config</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">allowUnfree</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>Then do a <code>nixos-rebuild switch</code> to activate it. You may also want to enable <a rel="noopener" target="_blank" href="https://github.com/nix-community/nix-direnv#via-configurationnix-in-nixos"><code>nix-direnv</code></a>.</p>
<h2 id="if-using-nix">If using <a rel="noopener" target="_blank" href="https://nixos.org/manual/nix/unstable/introduction.html">Nix</a></h2>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mkdir</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.config/nix/</span>
<span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>experimental-features = nix-command flakes<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>/.config/nix/nix.conf</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-env</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>iA</span> nixpkgs.nixUnstable</span>
</span></code></pre>
<p>You may also want to enable <a rel="noopener" target="_blank" href="https://github.com/nix-community/nix-direnv#with-nix-env"><code>nix-direnv</code></a>.</p>
<h1 id="setup">Setup</h1>
<p>For this article, I'll create a new crate. You can use your existing crate! You should also ensure it's a Git repository. (Flakes require this!)</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust">cargo init scratch
cd scratch
nvim Cargo<span class="z-punctuation z-accessor z-dot z-rust">.</span>toml
<span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Add a `description = &quot;boop&quot;` field under `[package]`!
</span>
git init
git add src<span class="z-keyword z-operator z-arithmetic z-rust">/</span> Cargo<span class="z-punctuation z-accessor z-dot z-rust">.</span>toml
</span></code></pre>
<h2 id="flake-nix"><code>flake.nix</code></h2>
<p>Next, we'll create a <code>flake.nix</code>. This is the coarse equivalent of a <code>Cargo.toml</code> file in Rust. (In fact, later we'll even see a <code>flake.lock</code>, just like Cargo!)</p>
<p><a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Flakes">Flakes</a> are a Nix file with a predetermined schema. The <a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Flakes#Flake_schema">wiki page</a> includes a schema.</p>
<p>Our flake will have three items in the root:</p>
<ul>
<li><strong><code>description</code>:</strong> A string description of the flake. Consider making this your crate description!</li>
<li><strong><code>inputs</code>:</strong> The inputs required by the flake. Generally <code>nixpkgs</code> and <code>naersk</code> (for the fancy Rust builder) will be enough.</li>
<li><strong><code>outputs</code>:</strong> A function accepting the (realized) inputs, returning the outputs of the flake, such as packages, NixOS modules, or library items!</li>
</ul>
<p>The first two are pretty self explanatory, let's dig into outputs! We only use a few of the available options:</p>
<ul>
<li><strong><code>overlay</code>:</strong> A <a rel="noopener" target="_blank" href="https://nixos.wiki/wiki/Overlays">Nix overlay</a> which can have package definitions added. Can be added to Nix systems to allow adding items to the environment (such as via <code>environment.systemPackages</code>.)</li>
<li><strong><code>packages</code>:</strong> A set of packages one could invoke with <code>nix run $FLAKE#packageName</code> or build with <code>nix build $FLAKE#packageName</code>.</li>
<li><strong><code>defaultPackage</code>:</strong> The default item to run/build when <code>nix run $FLAKE</code> or <code>nix build $FLAKE</code> is invoked.</li>
<li><strong><code>checks</code>:</strong> A set of checks (think like <code>cargo fmt</code>) to run whenever <code>nix flake check</code> is run. This is particularly useful for pre-commit hooks or CI.</li>
<li><strong><code>devShell</code>:</strong> An environment for when <code>nix develop</code> is run. This is also used in <code>nix-direnv</code>.</li>
</ul>
<p>You shouldn't need to make many changes to this file, <strong>but you should customize the <code>description</code> and remove any platforms you don't support</strong>.</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># flake.nix</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">description</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>My cute Rust crate!<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:NixOS/nixpkgs/nixpkgs-unstable<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">naersk</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nmattia/naersk<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">naersk</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">follows</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">self</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">naersk</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-keyword z-other z-nix">let</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">cargoToml</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">fromTOML</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">readFile</span> <span class="z-string z-unquoted z-path z-nix">./Cargo.toml</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">supportedSystems</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-linux<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-linux<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">forAllSystems</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">f</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">genAttrs</span> <span class="z-variable z-parameter z-name z-nix">supportedSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">f</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-keyword z-other z-nix">in</span>
    <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlay</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">final</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-function z-4 z-nix">prev</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">callPackage</span> <span class="z-string z-unquoted z-path z-nix">./.</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">naersk</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
            <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
            <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlays</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
              <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span>
            <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>


      <span class="z-entity z-other z-attribute-name z-multipart z-nix">defaultPackage</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlays</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">checks</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
            <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
            <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlays</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
              <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span>
            <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">format</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">runCommand</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>check-format<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span>
            <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">rustfmt</span> <span class="z-variable z-parameter z-name z-nix">cargo</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
            <span class="z-punctuation z-definition z-attrset z-nix">}</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
            <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">rustfmt</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/cargo-fmt fmt --manifest-path <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/Cargo.toml -- --check
            <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nixpkgs-fmt</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/nixpkgs-fmt --check <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>
            touch $out # it worked!
          <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShell</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
            <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
            <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlays</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputsFrom</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span>
            <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span>
          <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span>
            <span class="z-variable z-parameter z-name z-nix">rustfmt</span>
            <span class="z-variable z-parameter z-name z-nix">nixpkgs-fmt</span>
          <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">LIBCLANG_PATH</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">llvmPackages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">libclang</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/lib<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>

</span></code></pre>
<p>Then <code>git add flake.nix</code>.</p>
<h2 id="default-nix"><code>default.nix</code></h2>
<p>This file is specific to our crate! It is a Nix package. Let's break it down, top to bottom:</p>
<ul>
<li><strong>The Inputs (<code>{ the, stuff, here }:</code>):</strong> This list of function arguments represents all of the inputs into the
expression.</li>
<li><strong>A <code>let ... in</code> binding:</strong> Here we set a variable which when accessed evaluates the <code>Cargo.toml</code>.</li>
<li><strong>A <code>naersk</code> call:</strong> <a rel="noopener" target="_blank" href="https://github.com/nmattia/naersk"><code>naersk</code></a> is an improvement over the
<a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#rust"><code>nixpkgs.buildRustPackage</code></a> traditionally available.</li>
<li><strong>A <code>src</code> location:</strong> This is the location of your code!</li>
<li><strong><code>buildInputs</code>:</strong> A list of dependencies your crate needs at build time.</li>
<li><strong><code>checkInputs</code>:</strong> A list of dependencies for your crate at test time.</li>
<li><strong><code>doCheck</code>:</strong> If Nix should run checks (<code>cargo test</code>).</li>
<li><strong><code>CARGO_BUILD_INCREMENTAL</code> and <code>RUST_BACKTRACE</code>:</strong> Environment variables we opt to set.</li>
<li><strong><code>copyLibs</code>:</strong> If Nix should copy over built libraries as well.</li>
<li><strong><code>name</code> and <code>version</code>:</strong> Derived from your <code>Cargo.toml</code>.</li>
<li><strong><code>meta</code>:</strong> Some metadata about the package. Optionally you can set <code>mainProgram = &quot;thing&quot;</code> here.</li>
</ul>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># default.nix</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span> <span class="z-variable z-parameter z-function z-maybe z-nix">lib</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">naersk</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">stdenv</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">clangStdenv</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">hostPlatform</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">targetPlatform</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">pkg-config</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">libiconv</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">rustfmt</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">cargo</span>
<span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">rustc</span>
  <span class="z-comment z-line z-number-sign z-nix"># , llvmPackages # Optional</span>
  <span class="z-comment z-line z-number-sign z-nix"># , protobuf     # Optional</span>
<span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>

<span class="z-keyword z-other z-nix">let</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">cargoToml</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">fromTOML</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">readFile</span> <span class="z-string z-unquoted z-path z-nix">./Cargo.toml</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-keyword z-other z-nix">in</span>

<span class="z-variable z-parameter z-name z-nix">naersk</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">targetPlatform</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">buildPackage</span> <span class="z-keyword z-other z-nix">rec</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">src</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
    <span class="z-variable z-parameter z-name z-nix">rustfmt</span>
    <span class="z-variable z-parameter z-name z-nix">pkg-config</span>
    <span class="z-variable z-parameter z-name z-nix">cargo</span>
    <span class="z-variable z-parameter z-name z-nix">rustc</span>
    <span class="z-variable z-parameter z-name z-nix">libiconv</span>
  <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">checkInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">cargo</span> <span class="z-variable z-parameter z-name z-nix">rustc</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">doCheck</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">CARGO_BUILD_INCREMENTAL</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>false<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">RUST_BACKTRACE</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>full<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">copyLibs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-comment z-line z-number-sign z-nix"># Optional things you might need:</span>
  <span class="z-comment z-line z-number-sign z-nix">#</span>
  <span class="z-comment z-line z-number-sign z-nix"># If you depend on `libclang`:</span>
  <span class="z-comment z-line z-number-sign z-nix"># LIBCLANG_PATH = &quot;${llvmPackages.libclang}/lib&quot;;</span>
  <span class="z-comment z-line z-number-sign z-nix">#</span>
  <span class="z-comment z-line z-number-sign z-nix"># If you depend on protobuf:</span>
  <span class="z-comment z-line z-number-sign z-nix"># PROTOC = &quot;${protobuf}/bin/protoc&quot;;</span>
  <span class="z-comment z-line z-number-sign z-nix"># PROTOC_INCLUDE = &quot;${protobuf}/include&quot;;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">name</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">version</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">version</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">meta</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">lib</span>; <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">description</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">description</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">homepage</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">cargoToml</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">package</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">homepage</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">license</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">licenses</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">mit</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">maintainers</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">maintainers</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>

</span></code></pre>
<p>Then <code>git add default.nix</code>.</p>
<blockquote>
<p>While you could <em>technically</em> moosh <code>flake.nix</code> &amp; <code>default.nix</code> together, I think it's much nicer to keep them separate.</p>
</blockquote>
<h2 id="optional-nix-direnv-envrc">Optional: <code>nix-direnv</code> &amp; <code>.envrc</code></h2>
<p>In order to hook into <a rel="noopener" target="_blank" href="https://github.com/nix-community/nix-direnv"><code>nix-direnv</code></a>:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>use flake<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> .envrc</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">direnv</span></span><span class="z-meta z-function-call z-arguments z-shell"> reload</span>
</span></code></pre>
<p>Then <code>git add .envrc</code>.</p>
<h1 id="make-sure-it-works">Make sure it works</h1>
<p>Before we do a full proper build, we need to populate the <code>Cargo.lock</code>! (Skip this if you have one!)</p>
<blockquote>
<p>If you did not opt to use <code>nix-direnv</code>, now you need to call <code>nix develop .</code> to enter the full development shell.</p>
</blockquote>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> fetch</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> add Cargo.lock</span>
</span></code></pre>
<p>At this point you can try out <code>cargo build</code> and other relevant commands. They should work and use the libraries and tools provided by Nix.</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> check</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> build</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>release</span></span>
</span></code></pre>
<p>Go ahead and test a build:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Precautionary formatting...</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nixpkgs-fmt</span></span><span class="z-meta z-function-call z-arguments z-shell"> ./.</span>

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> flake check</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> build .</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> run .</span>
</span></code></pre>
<blockquote>
<p>Get trouble? Try running <code>nix build --print-build-logs --keep-failed</code> to be able to see logs and check the workdir.</p>
</blockquote>
<p>Here's it working:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix run .</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Hello,</span></span><span class="z-meta z-function-call z-arguments z-shell"> world!</span>
</span></code></pre>
<h1 id="in-the-real-world">In the real world</h1>
<p>So how does this do on other crates? I test these files to several other popular Rust packages, here's what I needed to change for each:</p>
<h3 id="ripgrep"><a rel="noopener" target="_blank" href="https://github.com/BurntSushi/ripgrep"><code>ripgrep</code></a></h3>
<p>I had to set <code>mainProgram</code> within the <code>meta</code> of <code>default.nix</code>:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># default.nix</span>
<span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">meta</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">lib</span>; <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-comment z-line z-number-sign z-nix"># ...</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">mainProgram</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>rg<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>  
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span> 
</span></code></pre>
<h3 id="bottom"><a rel="noopener" target="_blank" href="https://github.com/ClementTsang/bottom"><code>bottom</code></a></h3>
<p>I also had to set <code>mainProgram</code> to <code>btm</code>. I also had to set <code>doCheck = true</code> in <code>default.nix</code>, as the tests depended on floating environment variables the build didn't have.</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># default.nix</span>
<span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">doCheck</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">meta</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">lib</span>; <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-comment z-line z-number-sign z-nix"># ...</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">mainProgram</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>btm<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>  
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span> 
</span></code></pre>
<h3 id="nushell-nu"><a rel="noopener" target="_blank" href="https://github.com/nushell/nushell">Nushell (<code>nu</code>)</a></h3>
<p><code>nu</code> uses <em>recursive git dependencies</em> which are an issue for Naersk right now (<a rel="noopener" target="_blank" href="https://github.com/nmattia/naersk/issues/162">#162</a>), so I had to 'lift' those dependencies into the <code>Cargo.toml</code> as plain dependencies (with <code>git</code> and <code>rev</code> attributes):</p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> Cargo.toml</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> ...</span>

<span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">arrow</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">git</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>https://github.com/apache/arrow-rs<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">rev</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>9f56afb2d2347310184706f7d5e46af583557bea<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
</span></code></pre>
<p>In addition, I had to add <code>openssl</code> to the <code>buildInputs</code> in <code>default.nix</code>, and I set <code>doCheck = false</code> because some tests weren't able to touch certain places on the filesystem. Finally, like the others, I had to set <code>mainProgram</code>.</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># default.nix</span>
<span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-comment z-block z-nix">/* ... */</span><span class="z-invalid z-illegal">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">openssl</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span>
    <span class="z-comment z-line z-number-sign z-nix"># ...</span>
    <span class="z-variable z-parameter z-name z-nix">openssl</span>
  <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">doCheck</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">meta</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">lib</span>; <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-comment z-line z-number-sign z-nix"># ...</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">mainProgram</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nu<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>  
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<h1 id="getting-help">Getting help</h1>
<p>For general help with Nix, consult <a rel="noopener" target="_blank" href="https://discourse.nixos.org/">the forums</a>, for help with Rust try <a rel="noopener" target="_blank" href="https://users.rust-lang.org/">the forums</a>.</p>
<p>I also find <a rel="noopener" target="_blank" href="https://nix.dev/">nix.dev</a>, <a rel="noopener" target="_blank" href="https://nixos.wiki/">nixos.wiki</a>, and <a rel="noopener" target="_blank" href="https://nixos.org/manual/nix/unstable/introduction.html">the <code>nixUnstable</code> manual</a> very helpful.</p>
<p><strong>Need something more personal?</strong></p>
<p>These days my consultancy is working with Indigenous organizations or persons. If you fall into one of those categories, please contact me at <a href="mailto:consulting@hoverbear.org"><em>consulting@hoverbear.org</em></a>.</p>
<p>If you're a tech startup, or anyone else, I would love to recommend you to use the services of <a rel="noopener" target="_blank" href="https://determinate.systems/">Determinate Systems</a> for Nix problems, and <a rel="noopener" target="_blank" href="https://ferrous-systems.com/">Ferrous Systems</a> for Rust problems. They are owned and operated by people I trust.</p>

</main>
<footer class="post-footer">
    Connect through &nbsp<a href="mailto:operator@hoverbear.org">operator@hoverbear.org</a>,&nbsp;
    <a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;
    <a rel="me" href="https:&#x2F;&#x2F;hachyderm.io&#x2F;@ana">@ana@hachyderm.io</a> on Mastodon,</a>&nbsp;
    <a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
    or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
</footer>
<pre
        class="artifact"><a id="commit" href="https://github.com/Hoverbear/hoverbear.org/commit/a7f3ac3e20c5424a25d58796f935dcd77b273ec6
">a7f3ac3e20c5424a25d58796f935dcd77b273ec6
</a></pre></body>

</html>