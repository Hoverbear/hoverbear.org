<!DOCTYPE html>
<html>
<head>
    <!-- Fun compatability things -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">

    <!-- Information about this site -->
    <title>
        Configurable Nix packages
    </title>
    <meta name="description"
        content="Let your users bring their settings with them." />

    <!-- Various Twitter related content. -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;c62aa003cb3b175900.jpg" />
    <meta property='og:image' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;c62aa003cb3b175900.jpg" />
    <meta name="twitter:site" content="@a_hoverbear" />
    <meta name="twitter:creator" content="@a_hoverbear" />

    <meta name="twitter:title"
        content="Configurable Nix packages" />
    <meta property='og:title'
        content="Configurable Nix packages" />

    <meta property='og:url'
        content="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;configurable-nix-packages&#x2F;" />

    <meta name="twitter:description"
        content="The vim and neovim packages in Nixpkgs allow users to set custom configuration, including their customRC and any plugins they might want.
How do they accomplish it?
In this article, we&#x27;ll explore how to create packages with similar behavior. We&#x27;ll create a simple Rust app that consumes a configuration file, then create a Nix flake containing both an unwrapped binary package as well as a configurable package.
" />
    <meta property='og:description'
        content="The vim and neovim packages in Nixpkgs allow users to set custom configuration, including their customRC and any plugins they might want.
How do they accomplish it?
In this article, we&#x27;ll explore how to create packages with similar behavior. We&#x27;ll create a simple Rust app that consumes a configuration file, then create a Nix flake containing both an unwrapped binary package as well as a configurable package.
" />


    <!-- Talk about the homepage and the rss feed. -->
    <link rel="me" href="https:&#x2F;&#x2F;hachyderm.io&#x2F;@ana">
    <link rel="canonical" href="https:&#x2F;&#x2F;hoverbear.org">
    <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">

    <!-- Stylesheets are fun -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Delius&family=Fira+Code&family=Noto+Sans&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />

    <!-- Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css"
        integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js"
        integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O"
        crossorigin="anonymous"></script>
    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js"
        integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
</head>

<body>
    
<div id="hero-wrapper">
    <figure class="enriched " style="">
       <figcaption>Photo&nbsp;- <a href="https://unsplash.com/photos/VRdZBLqnoMU">Dylan McLeod</a></figcaption>
       

<img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;bb1e779c92bc1b7c00.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;c62aa003cb3b175900.jpg 3840w
              " sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,set 
                     3840px" src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;bb1e779c92bc1b7c00.jpg" alt="Photo" />
</figure>
</div>
<header>
    <div class="content">
        <h1 id="main-title"><a id="main-link" href="https:&#x2F;&#x2F;hoverbear.org">
                Configurable Nix packages
            </a></h1>

        <nav id="tree">
    <ul>
        <li>
            <a href="https://hoverbear.org/about/">
                Ana, Hoverbear üêª
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/blog/">
                Articles
            </a>&nbsp;
        </li></ul><ul>
        </ul><ul>
        </ul>
</nav>

        <div class="metadata">
            <h5 class="description">
                Let your users bring their settings with them.
            </h5>

            <p class="date">
                Posted on 2022-01-01, around 6 minutes of reading.
            </p>
        </div>
    </div>
</header>

<main>
    
<nav id=toc>
    <ol>
        
        <li>
            <a href="https://hoverbear.org/blog/configurable-nix-packages/#goal">Observing our goal</a>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/configurable-nix-packages/#makeOverrideable">Interacting with makeOverridable</a>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/configurable-nix-packages/#rust">A test application</a>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/configurable-nix-packages/#nix">Flexing Nix</a>
            
        </li>
        
        <li>
            <a href="https://hoverbear.org/blog/configurable-nix-packages/#test">Experimenting</a>
            
        </li>
        
    </ol>
</nav>

    <p>The <a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/tree/98f82e9c35aaf1eb32f0d8787e948da5ca970449/pkgs/applications/editors/vim"><code>vim</code></a> and <a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/tree/98f82e9c35aaf1eb32f0d8787e948da5ca970449/pkgs/applications/editors/neovim"><code>neovim</code></a> packages in <a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs">Nixpkgs</a> allow users to set custom configuration, including their <code>customRC</code> and any plugins they might want.</p>
<p>How do they accomplish it?</p>
<p>In this article, we'll explore how to create packages with similar behavior. We'll create a simple Rust app that consumes a configuration file, then create a Nix flake containing both an unwrapped binary package as well as a configurable package.</p>
<span id="continue-reading"></span><h1 id="goal">Observing our goal</h1>
<p>My <a rel="noopener" target="_blank" href="https://github.com/Hoverbear-Consulting/flake/blob/57ccc6aae264c6000017483d34783464cd393f4e/packages/neovim.nix"><code>neovimConfigured</code></a> derivation demonstrates the desired experience for our users:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">neovim</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">vimPlugins</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>

<span class="z-variable z-parameter z-name z-nix">neovim</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">vimAlias</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">viAlias</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">configure</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">customRC</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
      luafile <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-string z-unquoted z-path z-nix">../config/nvim/init.lua</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>
    <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">myVimPackage</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">vimPlugins</span>; <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">start</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
        <span class="z-variable z-parameter z-name z-nix">LanguageClient-neovim</span>
        <span class="z-comment z-line z-number-sign z-nix"># ...</span>
      <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>We're able to override the <code>neovim</code> package with some custom attributes which are then loaded when the <code>nvim</code> from that package is invoked. In theory, virtually any Nix user could run the following and get nearly my exact configuration:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> run github:hoverbear-consulting/flake#neovimConfigured</span>
</span></code></pre>
<p>In order to accomplish this, we'll make use of <a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable"><code>nixpkgs.lib.makeOverridable</code></a>.</p>
<h1 id="makeOverrideable">Interacting with <code>makeOverridable</code></h1>
<p>The <a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#sec-lib-makeOverridable"><code>makeOverridable</code></a> <em>(<a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/blob/98f82e9c35aaf1eb32f0d8787e948da5ca970449/lib/customisation.nix#L49-L93">source</a>)</em> function allows us to attach an <code>override</code> behavior to a given function.</p>
<p>Let's open our <code>nix repl</code> and try it:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">makeOverridable</span> <span class="z-invalid z-illegal">=</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-constant z-language z-nix">builtins</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">getFlake</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">makeOverridable</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">pretendPkg</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">args</span>@<span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">args</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">pretendPkg</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">foo</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-numeric z-nix">1</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
<span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">foo</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-numeric z-nix">1</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">overriddenPretendPkg</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-name z-nix">makeOverridable</span> <span class="z-variable z-parameter z-name z-nix">pretendPkg</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">overriddenPretendPkg</span>
<span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">override</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> ... <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">overrideDerivation</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-invalid z-illegal">¬´</span><span class="z-variable z-parameter z-function z-4 z-nix">lambda</span> @ <span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">1</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">9</span><span class="z-invalid z-illegal">8</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">q</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">v</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">f</span><span class="z-invalid z-illegal">7</span><span class="z-invalid z-illegal">d</span><span class="z-invalid z-illegal">4</span><span class="z-invalid z-illegal">-</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">l</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">m</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">a</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">.</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-punctuation z-definition z-function z-nix">:</span><span class="z-constant z-numeric z-nix">84</span><span class="z-invalid z-illegal">:</span><span class="z-constant z-numeric z-nix">32</span><span class="z-invalid z-illegal">¬ª</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>When we used <code>makeOverridable</code> with the <code>pretendPkg</code> function it creates a result (<code>overriddenPretendPkg</code>) as if the original function was called with the given attribute set (<code>{ default = true; }</code>), as well as two additional attributes: <code>override</code> and <code>overrideDerivation</code>.</p>
<p>Let's check out <code>override</code>:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">overriddenPretendPkg</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span>
<span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">__functionArgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> ... <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">__functor</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-invalid z-illegal">¬´</span><span class="z-variable z-parameter z-function z-4 z-nix">lambda</span> @ <span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">1</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">9</span><span class="z-invalid z-illegal">8</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">q</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">v</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">f</span><span class="z-invalid z-illegal">7</span><span class="z-invalid z-illegal">d</span><span class="z-invalid z-illegal">4</span><span class="z-invalid z-illegal">-</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">l</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">v</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">a</span><span class="z-invalid z-illegal">l</span><span class="z-invalid z-illegal">.</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-punctuation z-definition z-function z-nix">:</span><span class="z-constant z-numeric z-nix">346</span><span class="z-invalid z-illegal">:</span><span class="z-constant z-numeric z-nix">19</span><span class="z-invalid z-illegal">¬ª</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">overriddenPretendPkg</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
<span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">override</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> ... <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">overrideDerivation</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-invalid z-illegal">¬´</span><span class="z-variable z-parameter z-function z-4 z-nix">lambda</span> @ <span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">1</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">9</span><span class="z-invalid z-illegal">8</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">q</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">v</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">f</span><span class="z-invalid z-illegal">7</span><span class="z-invalid z-illegal">d</span><span class="z-invalid z-illegal">4</span><span class="z-invalid z-illegal">-</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">l</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">m</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">a</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">.</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-punctuation z-definition z-function z-nix">:</span><span class="z-constant z-numeric z-nix">84</span><span class="z-invalid z-illegal">:</span><span class="z-constant z-numeric z-nix">32</span><span class="z-invalid z-illegal">¬ª</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>

<span class="z-variable z-parameter z-name z-nix">nix-repl</span><span class="z-keyword z-operator z-nix">&gt;</span> <span class="z-variable z-parameter z-name z-nix">overriddenPretendPkg</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
<span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">override</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> ... <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">overrideDerivation</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-invalid z-illegal">¬´</span><span class="z-variable z-parameter z-function z-4 z-nix">lambda</span> @ <span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">1</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">h</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">j</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">z</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">5</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">p</span><span class="z-invalid z-illegal">9</span><span class="z-invalid z-illegal">8</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">q</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">v</span><span class="z-invalid z-illegal">2</span><span class="z-invalid z-illegal">3</span><span class="z-invalid z-illegal">k</span><span class="z-invalid z-illegal">f</span><span class="z-invalid z-illegal">7</span><span class="z-invalid z-illegal">d</span><span class="z-invalid z-illegal">4</span><span class="z-invalid z-illegal">-</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">r</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">e</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">l</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">b</span><span class="z-invalid z-illegal">/</span><span class="z-invalid z-illegal">c</span><span class="z-invalid z-illegal">u</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">m</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">s</span><span class="z-invalid z-illegal">a</span><span class="z-invalid z-illegal">t</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">o</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">.</span><span class="z-invalid z-illegal">n</span><span class="z-invalid z-illegal">i</span><span class="z-invalid z-illegal">x</span><span class="z-punctuation z-definition z-function z-nix">:</span><span class="z-constant z-numeric z-nix">84</span><span class="z-invalid z-illegal">:</span><span class="z-constant z-numeric z-nix">32</span><span class="z-invalid z-illegal">¬ª</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre>
<p>So <code>override</code> is a function which accepts an attribute set which it merges with the attribute set the <code>makeOverride</code> function is invoked with.</p>
<blockquote>
<p>Note: <strong><a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#sec-pkg-overrideDerivation"><code>overrideDerivation</code></a> is deprecated</strong>, so we won't discuss it.</p>
</blockquote>
<p>We can use <code>makeOverridable</code> on <strong>any function</strong> that accepts an attribute set, namely, a Nix package created through something like <code>mkDerivation</code> or <code>mkShell</code>.</p>
<p>Let's make a quick Rust application, after, we can make a Nix flake, package, and overridable package for it!</p>
<h1 id="rust">A test application</h1>
<p>First, let's quickly bootstrap a Rust package to play with. Make a <code>demo</code> directory and create the following two files:</p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> demo/Cargo.toml</span>
<span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">package</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">name</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>demo<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>0.1.0<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">edition</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>2021<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span>

<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">dependencies</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">structopt</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>0.3<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">toml</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>0.5<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">serde</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-array z-begin z-toml">[</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>derive<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span> <span class="z-punctuation z-definition z-array z-end z-toml">]</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">color-eyre</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>0.5<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">eyre</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-punctuation z-definition z-inline-table z-begin z-toml">{</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">version</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-string z-quoted z-double z-basic z-toml"><span class="z-punctuation z-definition z-string z-begin z-toml">&quot;</span>0.6<span class="z-punctuation z-definition z-string z-end z-toml">&quot;</span></span><span class="z-punctuation z-separator z-inline-table z-toml">,</span> <span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">default-features</span></span> <span class="z-punctuation z-definition z-key-value z-toml">=</span> <span class="z-constant z-language z-toml">false</span> <span class="z-punctuation z-definition z-inline-table z-end z-toml">}</span>

</span></code></pre>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> demo/src/main.rs
</span><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">eyre<span class="z-punctuation z-accessor z-rust">::</span></span>WrapErr<span class="z-punctuation z-terminator z-rust">;</span>
<span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">serde<span class="z-punctuation z-accessor z-rust">::</span></span>Deserialize<span class="z-punctuation z-terminator z-rust">;</span>
<span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">std<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span><span class="z-meta z-path z-rust">fs<span class="z-punctuation z-accessor z-rust">::</span></span>File<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">io<span class="z-punctuation z-accessor z-rust">::</span></span>Read<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">path<span class="z-punctuation z-accessor z-rust">::</span></span>PathBuf</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
<span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">structopt<span class="z-punctuation z-accessor z-rust">::</span></span>StructOpt<span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">StructOpt<span class="z-punctuation z-separator z-rust">,</span> Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">structopt</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">name <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>demo<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> about <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>A binary with a configuration file.<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
<span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">CliArgs</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> A path to a configuration file
</span>    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">structopt</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">
        short<span class="z-punctuation z-separator z-rust">,</span>
        long<span class="z-punctuation z-separator z-rust">,</span>
        <span class="z-meta z-function-call z-rust"><span class="z-variable z-function z-rust">parse</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-function-call z-rust">from_os_str</span><span class="z-meta z-function-call z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-separator z-rust">,</span>
        env <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>DEMO_CONFIG<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span>
        default_value <span class="z-keyword z-operator z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>/etc/demo.toml<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span>
    </span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">config</span><span class="z-punctuation z-separator z-type z-rust">:</span> PathBuf,
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Deserialize<span class="z-punctuation z-separator z-rust">,</span> Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
<span class="z-meta z-struct z-rust"><span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">Config</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> A togglable switch
</span>    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">allow</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">dead_code</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
    <span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">serde</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">default</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
    <span class="z-variable z-other z-member z-rust">switch</span><span class="z-punctuation z-separator z-type z-rust">:</span> <span class="z-storage z-type z-rust">bool</span>,
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

<span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-path z-rust">color_eyre<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">eyre<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-path z-rust">color_eyre<span class="z-punctuation z-accessor z-rust">::</span></span>install<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-storage z-type z-rust">let</span> cli_args <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">CliArgs<span class="z-punctuation z-accessor z-rust">::</span></span>from_args<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span><span class="z-constant z-other z-placeholder z-rust">{:#?}</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> cli_args<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> config_file <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">File<span class="z-punctuation z-accessor z-rust">::</span></span>open<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>cli_args<span class="z-punctuation z-accessor z-dot z-rust">.</span>config</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">wrap_err_with</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-support z-macro z-rust">format!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>Failed to open config <span class="z-constant z-other z-placeholder z-rust">{}</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> cli_args<span class="z-punctuation z-accessor z-dot z-rust">.</span>config<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">display</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> config_string <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-support z-type z-rust">String</span><span class="z-meta z-path z-rust"><span class="z-punctuation z-accessor z-rust">::</span></span>default<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
    config_file
        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">read_to_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span><span class="z-storage z-modifier z-rust">mut</span> config_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">wrap_err_with</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-support z-macro z-rust">format!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>Failed to read config <span class="z-constant z-other z-placeholder z-rust">{}</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> cli_args<span class="z-punctuation z-accessor z-dot z-rust">.</span>config<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">display</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-storage z-type z-rust">let</span> config<span class="z-punctuation z-separator z-rust">:</span> Config <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">toml<span class="z-punctuation z-accessor z-rust">::</span></span>from_str<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>config_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
        <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">wrap_err_with</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-support z-macro z-rust">format!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>Failed to parse config <span class="z-constant z-other z-placeholder z-rust">{}</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> cli_args<span class="z-punctuation z-accessor z-dot z-rust">.</span>config<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">display</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
    <span class="z-support z-macro z-rust">println!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span><span class="z-constant z-other z-placeholder z-rust">{:#?}</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-separator z-rust">,</span> config<span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

</span></code></pre>
<p>This will create a program which accepts a given config, loads it, and prints it out to <code>stdout</code>. That should be sufficient to tell if we've succeeded in our task later!</p>
<p>If you already have a global Rust environment set up, you can give this a test with <code>cargo run</code> or <code>DEMO_CONFIG=/some/path cargo run</code>. If you don't have one, you'll be able to do this after the next step.</p>
<h1 id="nix">Flexing Nix</h1>
<p>Now our little crate needs a Nix package. We'll use <a rel="noopener" target="_blank" href="https://github.com/oxalica/rust-overlay"><code>github:oxalica/rust-overlay</code></a> and <a rel="noopener" target="_blank" href="https://github.com/nix-community/naersk"><code>github:nix-community/naersk</code></a> today, so our <code>demo</code> crate is built like so:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># Chunk of a Flake.nix</span>
<span class="z-variable z-parameter z-name z-nix">overlay</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">final</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-function z-4 z-nix">prev</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">demo-unwrapped</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">naersk</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">hostPlatform</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">buildPackage</span> <span class="z-keyword z-other z-nix">rec</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">pname</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">version</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>0.0.1<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">src</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">gitignore</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">gitignoreSource</span> <span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-comment z-line z-number-sign z-nix"># ...</span>
</span></code></pre>
<blockquote>
<p>Note: We suffix it with <code>-unwrapped</code> so the configurable package can be <code>demo</code>. We call it 'unwrapped' since we will be 'wrapping' the package to make it configurable.</p>
</blockquote>
<p>Then we'll define a <code>wrapDemo</code> function which takes some given non-overridable <code>demo</code> package and makes it overridable.</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">wrapDemo</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">demo-unwrapped</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">makeOverridable</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">configuration</span> <span class="z-keyword z-operator z-nix">?</span> <span class="z-constant z-language z-nix">null</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
  <span class="z-keyword z-other z-nix">if</span> <span class="z-variable z-parameter z-name z-nix">configuration</span> <span class="z-keyword z-operator z-nix">==</span> <span class="z-constant z-language z-nix">null</span> <span class="z-keyword z-other z-nix">th</span><span class="z-keyword z-other z-nix">en</span>
    <span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span>
  <span class="z-keyword z-other z-nix">el</span><span class="z-keyword z-other z-nix">se</span>
    <span class="z-keyword z-other z-nix">let</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">configurationFile</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">writeTextFile</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo-config<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">text</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">configuration</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-keyword z-other z-nix">in</span>
    <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">symlinkJoin</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo-<span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">getVersion</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">paths</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">nativeBuildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">final</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">makeWrapper</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">postBuild</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
        makeWrapper <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/demo \
          <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">placeholder</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>out<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/demo \
          --set-default DEMO_CONFIG <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">configurationFile</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>
      <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-invalid z-illegal">;</span>
</span></code></pre>
<p>The <code>{ configuration ? null }</code> (on the first line) is the available options to override, here you could add, remove, or change what users can manipulate.</p>
<p><a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#trivial-builder-symlinkJoin"><code>symlinkJoin</code></a> (<a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/blob/b487ccf50099eee2da77227d9fb99c84cc90a0c7/pkgs/build-support/trivial-builders.nix#L325-L391">source</a>) is a builder like <code>mkDerivation</code>, and produces what <code>nix run</code> (and the rest) expect.</p>
<p>The <code>placeholder</code> function, a <a rel="noopener" target="_blank" href="https://nixos.org/manual/nix/stable/expressions/builtins.html">Nix builtin</a>, returns a placeholder for one of the <a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#chap-multiple-output">outputs</a> of a package.</p>
<p>In the <code>postBuild</code> step of the derivation we'll make use of <a rel="noopener" target="_blank" href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper"><code>makeWrapper</code></a> (<a rel="noopener" target="_blank" href="https://github.com/NixOS/nixpkgs/blob/ba09908b2c15c40f5c0c3d11ebe6c1d6c440a9ce/pkgs/build-support/setup-hooks/make-wrapper.sh">source</a>), which allows us to do things like set arguments and populate environment variables.</p>
<p>With that, we can define the 'wrapped' package:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">demo</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">wrapDemo</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-invalid z-illegal">;</span>
</span></code></pre>
<p>So whole flake looks like so:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-comment z-line z-number-sign z-nix"># demo/flake.nix</span>
<span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
  <span class="z-entity z-other z-attribute-name z-multipart z-nix">description</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>An example of a configurable Nix package.<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">rust-overlay</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:oxalica/rust-overlay<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">rust-overlay</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">follows</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">naersk</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:nix-community/naersk<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">naersk</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">follows</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">gitignore</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>github:hercules-ci/gitignore.nix<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">gitignore</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">follows</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>nixpkgs<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">self</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">rust-overlay</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">naersk</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">gitignore</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
    <span class="z-keyword z-other z-nix">let</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">supportedSystems</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-linux<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-linux<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>x86_64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>aarch64-darwin<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">forAllSystems</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">f</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">genAttrs</span> <span class="z-variable z-parameter z-name z-nix">supportedSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">f</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgsForSystem</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlays</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
          <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span>
          <span class="z-variable z-parameter z-name z-nix">rust-overlay</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">overlay</span>
          <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">self</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-function z-4 z-nix">super</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-punctuation z-section z-function z-arguments z-nix">(</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">rust-bin</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">stable</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">latest</span><span class="z-punctuation z-section z-function z-arguments z-nix">)</span> <span class="z-entity z-other z-attribute-name z-single z-nix">rustc</span> <span class="z-entity z-other z-attribute-name z-single z-nix">cargo</span> <span class="z-entity z-other z-attribute-name z-single z-nix">rustdoc</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span>
        <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-keyword z-other z-nix">in</span>
    <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">overlay</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">final</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-function z-4 z-nix">prev</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">demo-unwrapped</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">naersk</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">hostPlatform</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">buildPackage</span> <span class="z-keyword z-other z-nix">rec</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pname</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">version</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>0.0.1<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">src</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">gitignore</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">gitignoreSource</span> <span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">wrapDemo</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-function z-4 z-nix">demo-unwrapped</span><span class="z-punctuation z-definition z-function z-nix">:</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">makeOverridable</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">configuration</span> <span class="z-keyword z-operator z-nix">?</span> <span class="z-constant z-language z-nix">null</span> <span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
          <span class="z-keyword z-other z-nix">if</span> <span class="z-variable z-parameter z-name z-nix">configuration</span> <span class="z-keyword z-operator z-nix">==</span> <span class="z-constant z-language z-nix">null</span> <span class="z-keyword z-other z-nix">th</span><span class="z-keyword z-other z-nix">en</span>
            <span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span>
          <span class="z-keyword z-other z-nix">el</span><span class="z-keyword z-other z-nix">se</span>
            <span class="z-keyword z-other z-nix">let</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">configurationFile</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">writeTextFile</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
                <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo-config<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
                <span class="z-entity z-other z-attribute-name z-multipart z-nix">text</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">configuration</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
              <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-keyword z-other z-nix">in</span>
            <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">symlinkJoin</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>demo-<span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">getVersion</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">paths</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">nativeBuildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">final</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">makeWrapper</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
              <span class="z-entity z-other z-attribute-name z-multipart z-nix">postBuild</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
                makeWrapper <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/demo \
                  <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">placeholder</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>out<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/demo \
                  --set-default DEMO_CONFIG <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">configurationFile</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>
              <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
            <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-entity z-other z-attribute-name z-multipart z-nix">demo</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">wrapDemo</span> <span class="z-variable z-parameter z-name z-nix">final</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo-unwrapped</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
      <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">defaultPackage</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgsForSystem</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo</span>
      <span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgsForSystem</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-punctuation z-section z-function z-arguments z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-punctuation z-section z-function z-arguments z-nix">)</span> <span class="z-entity z-other z-attribute-name z-single z-nix">demo</span> <span class="z-entity z-other z-attribute-name z-single z-nix">demo-unwrapped</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">demoConfigured</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
            <span class="z-entity z-other z-attribute-name z-multipart z-nix">configuration</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
              switch = true
            <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShell</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgsForSystem</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputsFrom</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs-fmt</span> <span class="z-variable z-parameter z-name z-nix">cargo</span> <span class="z-variable z-parameter z-name z-nix">rust-bin</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">stable</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">latest</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">default</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>

      <span class="z-entity z-other z-attribute-name z-multipart z-nix">checks</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
        <span class="z-keyword z-other z-nix">let</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgsForSystem</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-keyword z-other z-nix">in</span>
        <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">format</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">runCommand</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span>check-format<span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span>
            <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
            <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nixpkgs-fmt</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/bin/nixpkgs-fmt --check <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-string z-unquoted z-path z-nix">./.</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>
            touch $out # it worked!`
          <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
          <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-punctuation z-section z-function z-arguments z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-punctuation z-section z-function z-arguments z-nix">)</span> <span class="z-entity z-other z-attribute-name z-single z-nix">demo</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
          <span class="z-entity z-other z-attribute-name z-multipart z-nix">demoConfigured</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">packages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">&quot;</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">&quot;</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demoConfigured</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
        <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
<span class="z-punctuation z-definition z-attrset z-nix">}</span>

</span></code></pre>
<p>If you use <code>direnv</code> you can add this too:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> demo/.envrc</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> reload when these files change</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">watch_file</span></span><span class="z-meta z-function-call z-arguments z-shell"> flake.nix</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">watch_file</span></span><span class="z-meta z-function-call z-arguments z-shell"> flake.lock</span>
<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> load the flake devShell</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-eval z-shell">eval</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> print-dev-env</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>

</span></code></pre>
<figure class="enriched " style="">
       <figcaption>A scientist doing an experiment.&nbsp;- <a href="https://unsplash.com/photos/JxoWb7wHqnA">@nci</a></figcaption>
       

<img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;3690150941feb85400.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;1b9b5f5dd1f7917500.jpg 3840w
              " sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,set 
                     3840px" src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;3690150941feb85400.jpg" alt="A scientist doing an experiment." />
</figure>
<h1 id="test">Experimenting</h1>
<p>Let's validate that this works!</p>
<p>In our <code>Flake.nix</code> we also defined a <code>demoConfigured</code> package which uses <code>override</code> and sets a custom <code>configuration</code>:</p>
<pre data-lang="nix" class="language-nix z-code"><code class="language-nix" data-lang="nix"><span class="z-source z-nix"><span class="z-variable z-parameter z-name z-nix">packages</span> <span class="z-invalid z-illegal">=</span> <span class="z-variable z-parameter z-name z-nix">forAllSystems</span> <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
  <span class="z-keyword z-other z-nix">let</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgsForSystem</span> <span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-keyword z-other z-nix">in</span>
  <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
    <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-punctuation z-section z-function z-arguments z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-punctuation z-section z-function z-arguments z-nix">)</span> <span class="z-entity z-other z-attribute-name z-single z-nix">demo</span> <span class="z-entity z-other z-attribute-name z-single z-nix">demo-unwrapped</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
    <span class="z-entity z-other z-attribute-name z-multipart z-nix">demoConfigured</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">demo</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">override</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
      <span class="z-entity z-other z-attribute-name z-multipart z-nix">configuration</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">&#39;&#39;</span>
        switch = true
      <span class="z-punctuation z-definition z-string z-other z-end z-nix">&#39;&#39;</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-invalid z-illegal">;</span>
</span></code></pre>
<p>We can run it as well as the default <code>demo</code> and validate the configuration file does get overriden:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix run .#demo</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">CliArgs</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
    config: <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/demo.toml<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-punctuation z-separator z-shell">,</span>
<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Error:</span></span><span class="z-meta z-function-call z-arguments z-shell"> </span>
   <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">0:</span></span><span class="z-meta z-function-call z-arguments z-shell"> Failed to open config /etc/demo.toml</span>
   <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">1:</span></span><span class="z-meta z-function-call z-arguments z-shell"> No such file or directory (os error 2</span><span class="z-meta z-function-call z-shell"></span>)

<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Backtrace</span></span><span class="z-meta z-function-call z-arguments z-shell"> omitted.</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Run</span></span><span class="z-meta z-function-call z-arguments z-shell"> with RUST_BACKTRACE=1 environment variable to display it.</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Run</span></span><span class="z-meta z-function-call z-arguments z-shell"> with RUST_BACKTRACE=full to include source snippets.</span>
</span></code></pre>
<p>Now the configured one:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> nix run .#demoConfigured</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">CliArgs</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
    config: <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/nix/store/9q4hmdspzh4riga0k3xsy1zsg2s33q09-demo-config<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-punctuation z-separator z-shell">,</span>
<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">Config</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>
    switch: true<span class="z-punctuation z-separator z-shell">,</span>
<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span>
</span></code></pre>
<p>Fantastic! We can see <code>switch</code> got set in our <code>demoConfigured</code> package, and the config file it reads from is part of our Nix store.</p>
<p>As you can see, Nix lets us make configurable wrappers around our packages quite easily, allowing your users to take their configuration with them.</p>

</main>
<footer class="post-footer">
    Connect through &nbsp<a href="mailto:operator@hoverbear.org">operator@hoverbear.org</a>,&nbsp;
    <a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;
    <a rel="me" href="https:&#x2F;&#x2F;hachyderm.io&#x2F;@ana">@ana@hachyderm.io</a> on Mastodon,</a>&nbsp;
    <a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
    or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
</footer>
<pre
        class="artifact"><a id="commit" href="https://github.com/Hoverbear/hoverbear.org/commit/71ff4f2443a6a28a399e4a9c9aed096e3c80bf13
">71ff4f2443a6a28a399e4a9c9aed096e3c80bf13
</a></pre></body>

</html>