<!DOCTYPE html>
<html>
    <head>
        <!-- Fun compatability things -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">                  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">
    
        <!-- Information about this site -->
        <title>Rust, Travis, and Github Pages
        </title>
        <meta name="description" content="A computer scientist working in open source towards a more hopeful future." />
    
        <!-- Various Twitter related content. -->
        <meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="[object]"/>
        <meta property='og:image' content="[object]"/>
        <meta name="twitter:site" content="@a_hoverbear"/>
        <meta name="twitter:creator" content="@a_hoverbear"/>
        
        
            <meta name="twitter:title" content="Rust, Travis, and Github Pages"/>
            <meta property='og:title' content="Rust, Travis, and Github Pages"/>
        

        
            <meta property='og:url' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;rust-travis-github-pages&#x2F;"/>
        

        
            <meta name="twitter:description" content="Rust is probably my favorite programming language (as the contents of this site suggests). My interests in networks, development operations, and systems programming align strongly with Rust. They&#x27;re pursuing the trifecta: Safe, Fast, Concurrent. It&#x27;s been a great learning journey for me so far and I learnt to write better code in all languages.
Github Pages is Github&#x27;s very generous offering of web hosting to your projects. Basically, you create a branch gh-pages and push it to Github, then browse to https:&#x2F;&#x2F;$USERNAME.github.io&#x2F;$REPOSITORY.
"/>
            <meta property='og:description' content="Rust is probably my favorite programming language (as the contents of this site suggests). My interests in networks, development operations, and systems programming align strongly with Rust. They&#x27;re pursuing the trifecta: Safe, Fast, Concurrent. It&#x27;s been a great learning journey for me so far and I learnt to write better code in all languages.
Github Pages is Github&#x27;s very generous offering of web hosting to your projects. Basically, you create a branch gh-pages and push it to Github, then browse to https:&#x2F;&#x2F;$USERNAME.github.io&#x2F;$REPOSITORY.
"/>
        
    
        <!-- Talk about the homepage and the rss feed. -->
        <link rel="canonical" href="https:&#x2F;&#x2F;hoverbear.org">
        <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">
    
        <!-- Stylesheets are fun -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Delius&family=Fira+Code&family=Noto+Sans&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />
    
        <!-- Katex -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
        <!-- To automatically render math in text elements, include the auto-render extension: -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    </head>
    

    <body>
        
    <div id="hero-wrapper">
    <figure class="enriched ">
        <figcaption>Photo&nbsp;- <a href="https://unsplash.com/photos/-N0cgDSF_MI">Kobi Li</a></figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Photo" />
    </figure>
</div>

    <header>
    <div class="content">
        <h1 id="main-title"><a id="main-link" href="https:&#x2F;&#x2F;hoverbear.org">
            Rust, Travis, and Github Pages
        </a></h1>

        <nav id="tree"><ul><li>
            <a href="https://hoverbear.org/consulting/">
                Consulting Services
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/about/">
                Ana, Hoverbear üêª
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/blog/">
                Articles
            </a>&nbsp;
        </li></ul><ul></ul><ul></ul>
</nav>


        <div class="metadata">
            <p class="description">
                    A computer scientist working in open source towards a more hopeful future.
                </p>

            <p class="date">
                    Posted on 2015-03-07, around 7 minutes of reading.
                </p>
        </div>
    </div>
</header>

    <main>
        
    <nav id=toc>
        <ol>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#making-a-demo-project">Making a Demo Project</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#starting-with-travis">Starting with Travis</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#set-up-your-repository">Set up your Repository</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#giving-travis-permissions">Giving Travis Permissions</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#tinkering-with-the-crate">Tinkering with the Crate</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#tinkering-with-travis">Tinkering with Travis</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/rust-travis-github-pages/#a-while-later">A While Later...</a>
                
            </li>
            
        </ol>
    </nav>

        <p><a rel="noopener" target="_blank" href="http://rust-lang.org/">Rust</a> is probably my favorite programming language (as the contents of this site suggests). My interests in networks, development operations, and systems programming align strongly with Rust. They're pursuing the trifecta: <em>Safe, Fast, Concurrent.</em> It's been a great learning journey for me so far and I learnt to write better code in <strong>all</strong> languages.</p>
<p><a rel="noopener" target="_blank" href="https://pages.github.com/">Github Pages</a> is Github's very generous offering of web hosting to your projects. Basically, you create a branch <code>gh-pages</code> and push it to Github, then browse to <a rel="noopener" target="_blank" href="https://hoverbear.github.io/raft"><code>https://$USERNAME.github.io/$REPOSITORY</code></a>.</p>
<span id="continue-reading"></span>
<p><a rel="noopener" target="_blank" href="https://travis-ci.org/">TravisCI</a> offers free continuous integration for open-source projects. It's even integrated with <a rel="noopener" target="_blank" href="http://www.rust-ci.org/">rust-ci</a>. I've had a great experience with the service. They're also the source of the little build status buttons like this one <a rel="noopener" target="_blank" href="https://travis-ci.org/Hoverbear/raft"><img src="https://travis-ci.org/Hoverbear/raft.svg?branch=master" alt="Build Status" /></a>.</p>
<p>Today, we'll talk about how to set up your very own Rust project to:</p>
<ul>
<li>Automagically build and test your project.</li>
<li>On a successful test push a new version of your documentation onto a <code>gh-pages</code> branch, as provided by <code>rustdoc</code>.</li>
</ul>
<h2 id="making-a-demo-project">Making a Demo Project</h2>
<p>Let's make a demo repository to play.</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>cargo new travis-demo
</span><span>cd travis-demo
</span></code></pre>
<p>For simplicity, we'll replace the contents of <code>src/lib.rs</code> with the following:</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>#![crate_name = &quot;travis-demo&quot;]
</span><span>#![crate_type = &quot;lib&quot;]
</span><span>
</span><span>//! This is a comment.
</span><span>
</span><span>/// This function always returns true. It&#39;s very useful!
</span><span>pub fn always_true() -&gt; bool { true }
</span><span>
</span><span>#[test]
</span><span>fn it_works() {
</span><span>    assert_eq!(always_true(), true);
</span><span>}
</span></code></pre>
<blockquote>
<p>If you haven't had a chance to learn about <code>rustdoc</code> you can read about it <a rel="noopener" target="_blank" href="http://doc.rust-lang.org/book/documentation.html">here</a>.</p>
</blockquote>
<p>Now you can run <code>cargo doc</code> and visit a url like <code>file:///Users/hoverbear/travis-demo/target/doc/travis-demo/</code> to view the generated documentation.</p>
<figure class="enriched ">
        <figcaption>Our Documentation</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Our Documentation" />
    </figure>
<p>Finally, push this project up to Github (You'll need to make it on Github!):</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>git add Cargo.toml src .gitignore
</span><span>git commit -m &quot;Initial commit.&quot;
</span><span>git remote add origin git@github.com:Hoverbear/travis-demo.git
</span><span>git push -u origin master
</span></code></pre>
<h2 id="starting-with-travis">Starting with Travis</h2>
<p>First, you'll need to sign up with Travis. This is trivially done by visiting <a rel="noopener" target="_blank" href="https://travis-ci.org/">TravisCI</a> and signing in with Github.</p>
<p>Then, visit your profile by clicking on your name in the top right corner.</p>
<figure class="enriched ">
        <figcaption>How to get to your profile.</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="How to get to your profile." />
    </figure>
<p>On this page, in the &quot;Repositories&quot; tab, you'll see a list of all your public repositories. If you <em>just</em> made your repository you might need to tell Travis to <strong>Sync Now</strong>.</p>
<blockquote>
<p>Travis has a <code>.com</code> for your private repositories.</p>
</blockquote>
<p>Now enable our demo repository by flipping the switch.</p>
<p>Feel encouraged to take a moment to click on the wrench and explore the options Travis offers. We'll play with them in a minute!</p>
<h2 id="set-up-your-repository">Set up your Repository</h2>
<blockquote>
<p>KMC offers us a <a rel="noopener" target="_blank" href="https://github.com/kmcallister/travis-doc-upload/blob/master/README.md">more secure approach</a> for users who do not wish to permit Travis to push to their repositories.</p>
</blockquote>
<p>Travis uses a <code>.travis.yml</code> to configure how it works. You can read more about it <a rel="noopener" target="_blank" href="http://docs.travis-ci.com/user/build-configuration/">here</a>.</p>
<p>We can add the following to ours:</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>language: rust
</span><span>after_success: |
</span><span>  [ $TRAVIS_BRANCH = master ] &amp;&amp;
</span><span>  [ $TRAVIS_PULL_REQUEST = false ] &amp;&amp;
</span><span>  cargo doc &amp;&amp;
</span><span>  echo &quot;&lt;meta http-equiv=refresh content=0;url=`echo $TRAVIS_REPO_SLUG | cut -d &#39;/&#39; -f 2`/index.html&gt;&quot; &gt; target/doc/index.html &amp;&amp;
</span><span>  sudo pip install ghp-import &amp;&amp;
</span><span>  ghp-import -n target/doc &amp;&amp;
</span><span>  git push -fq https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git gh-pages
</span></code></pre>
<p><code>language:</code> lets us specify <code>rust</code>, which for now defaults to the latest nightly.</p>
<p><code>after_success:</code> lets us declare a script to run after a successful build. I found this series of steps <em>somewhere</em>, modified them a bit, and they work fantastic. The script basically does the following:</p>
<ul>
<li>If it's <em>not</em> a push to <code>master</code> finish.</li>
<li>Otherwise, run <code>cargo doc</code></li>
<li>Make a redirect in the <code>index.html</code> to the proper location. (This assumes your repository name is the same as your crate, feel free to change it.)</li>
<li>Pushes the new copy of documentation to Github using a secure token. (More on that in a second.)</li>
</ul>
<p><strong>But wait!</strong> Where do we get the Token?</p>
<h2 id="giving-travis-permissions">Giving Travis Permissions</h2>
<p>Since it would be positively outrageous to give Travis your Github password or private key, we'll use what's called an &quot;access token&quot;. To get one of these, go to your Github settings and hit the &quot;Applictions&quot; tab.</p>
<figure class="enriched ">
        <figcaption>Getting a token</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Getting a token" />
    </figure>
<figure class="enriched ">
        <figcaption>Token Creation Screen</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Token Creation Screen" />
    </figure>
<p>Once you hit &quot;Generate Token&quot; you'll return to the previous page and see a green highlighted key. <strong>Copy that, you won't see it again!</strong></p>
<p>Now, install the <a rel="noopener" target="_blank" href="https://github.com/travis-ci/travis.rb#installation">Travis Gem</a>. Then you need to authenticate using <code>travis login</code> using your Github credentials.</p>
<p>Once Travis is installed and logged in, you can run this, where <code>$YOUR_TOKEN</code> is the one we copied earlier.</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>travis encrypt GH_TOKEN=$YOUR_TOKEN --add env.global
</span></code></pre>
<p>This command should automatically add a few lines to your <code>.travis.yml</code>.</p>
<blockquote>
<p><strong>Why encrypt?</strong> Because it's probably a bad idea to store an access token for your Github account in the clear.</p>
</blockquote>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>git add .travis.yml
</span><span>git commit -m &quot;Add Travis&quot;
</span><span>git push
</span></code></pre>
<p>Now if you visit <a rel="noopener" target="_blank" href="https://travis-ci.org/repositories"><code>https://travis-ci.org/repositories</code></a> you should, eventually, see your build pop up! Note that Travis can take a moment to start a build.</p>
<p>Your build should look similar to the following:</p>
<figure class="enriched ">
        <figcaption>Example Build</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Example Build" />
    </figure>
<h2 id="tinkering-with-the-crate">Tinkering with the Crate</h2>
<p>Unfortunately, the first build of a <code>gh-pages</code> branch can take awhile to become available. <em>So just relax, and lets tinker with things a bit.</em></p>
<p>Let's go back to your <code>src/lib.rs</code> and add a couple more declarations.</p>
<p><strong>To set a base URL</strong> you can add this:</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>#![doc(html_root_url = &quot;https://hoverbear.github.io/travis-demo/&quot;)]
</span></code></pre>
<p><strong>To set an image for the documentation</strong> you can add an image to your Github repository and do something like the following:</p>
<pre style="background-color:#212733;color:#ccc9c2;"><code><span>#![doc(html_logo_url = &quot;https://raw.githubusercontent.com/Hoverbear/travis-demo/master/demo.png&quot;)]
</span></code></pre>
<p>Once you change those, commit them, push it to <code>origin master</code>, and visit Travis again. You can see Travis will take the new revision and test it as well. (You can see there is even a &quot;Build Log&quot;) Once the test succeeds you'll see, again, how it builds docs and sets them up.</p>
<blockquote>
<p>If you create a pull request or branch, you'll notice that the Travis builds don't push new documentation except to commits on <code>master</code>.</p>
</blockquote>
<h2 id="tinkering-with-travis">Tinkering with Travis</h2>
<p>Travis offers us some great options for configuring our output during tests.</p>
<p>The first is <code>RUST_BACKTRACE</code>, we can set it to <code>1</code> to make Rust print out a stacktrace on a panic. This is particularly useful combined with <code>panic!()</code>, <code>unreachable!()</code> and <code>unimplemented!()</code> which you can use to structure failure modes in your programs.</p>
<p>If you use <a rel="noopener" target="_blank" href="https://github.com/rust-lang/log"><code>log</code> and <code>env-logger</code></a> you also might want to set <code>RUST_LOG</code>. I would definitely suggest limiting the logging to a specific crate as otherwise <code>rustc</code> and other libs will spout a considerable amount of output.</p>
<figure class="enriched ">
        <figcaption>Setting ENV Variables</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Setting ENV Variables" />
    </figure>
<h2 id="a-while-later">A While Later...</h2>
<p>Try visiting <a rel="noopener" target="_blank" href="https://hoverbear.github.io/raft/"><code>https://$YOUR_GITHUB_USER.github.io/$YOUR_REPO</code></a>. Did it work? Awesome!</p>
<p>Don't forget to add it to the repository page on Github!</p>
<figure class="enriched ">
        <figcaption>Our new Repo</figcaption>
        <img srcset="
              [object] 1920w,
              [object] 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="[object]"
              alt="Our new Repo" />
    </figure>
<p>Enjoy your new documentation! Your users will appreciate your documentation being up to date, you don't need to do it yourself, and later on you can hack this method to only handle commits to <code>stable</code> or other tags.</p>

    </main>
    <footer class="post-footer">
    Connect through &nbsp<a href="mailto:operator@hoverbear.org">operator@hoverbear.org</a>,&nbsp;<a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;<a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
    or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
</footer>
<pre class="artifact"><a id="commit" href="https://github.com/Hoverbear/hoverbear.org/commit/6de40468eff2042c3ccb5a59dc2b7ebc520d268c
">6de40468eff2042c3ccb5a59dc2b7ebc520d268c
</a></pre>
    </body>

</html>
