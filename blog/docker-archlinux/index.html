<!DOCTYPE html>
<html>
    <head>
        <!-- Fun compatability things -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">                  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">
    
        <!-- Information about this site -->
        <title>Arch Linux on Docker Revisited
        </title>
        <meta name="description" content="A computer scientist working in open source towards a more hopeful future." />
    
        <!-- Various Twitter related content. -->
        <meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;0bc3da24a0d6405e00.jpg"/>
        <meta property='og:image' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;0bc3da24a0d6405e00.jpg"/>
        <meta name="twitter:site" content="@a_hoverbear"/>
        <meta name="twitter:creator" content="@a_hoverbear"/>
        
        
            <meta name="twitter:title" content="Arch Linux on Docker Revisited"/>
            <meta property='og:title' content="Arch Linux on Docker Revisited"/>
        

        
            <meta property='og:url' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;docker-archlinux&#x2F;"/>
        

        
            <meta name="twitter:description" content="Back in 2014 when I was learning about Docker I got around to making a base image for Arch Linux. It was a really fun exploration and I got to know a lot more about how Docker worked from it. I&#x27;d highly suggest trying to make your own sometime!
Docker has matured a lot since, and I&#x27;ve enjoyed following it. I took some time this last week to revisit my Arch Linux image and ensure it&#x27;s still functional. I wasn&#x27;t surprised when the scripts continued to work just fine, even after two years.
With nothing broken, I knew I only had one choice. I had to improve it!
"/>
            <meta property='og:description' content="Back in 2014 when I was learning about Docker I got around to making a base image for Arch Linux. It was a really fun exploration and I got to know a lot more about how Docker worked from it. I&#x27;d highly suggest trying to make your own sometime!
Docker has matured a lot since, and I&#x27;ve enjoyed following it. I took some time this last week to revisit my Arch Linux image and ensure it&#x27;s still functional. I wasn&#x27;t surprised when the scripts continued to work just fine, even after two years.
With nothing broken, I knew I only had one choice. I had to improve it!
"/>
        
    
        <!-- Talk about the homepage and the rss feed. -->
        <link rel="canonical" href="https:&#x2F;&#x2F;hoverbear.org">
        <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">
    
        <!-- Stylesheets are fun -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Delius&family=Fira+Code&family=Noto+Sans&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />
    
        <!-- Katex -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
        <!-- To automatically render math in text elements, include the auto-render extension: -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    </head>
    

    <body>
        
    <div id="hero-wrapper">
    <figure class="enriched ">
        <figcaption>Photo</figcaption>
        <img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;1a1edbf0dbc52cbb00.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;0bc3da24a0d6405e00.jpg 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;5e0c8d8e963d97ab00.jpg"
              alt="Photo" />
    </figure>
</div>

    <header>
    <div class="content">
        <h1 id="main-title"><a id="main-link" href="https:&#x2F;&#x2F;hoverbear.org">
            Arch Linux on Docker Revisited
        </a></h1>

        <nav id="tree"><ul><li>
            <a href="https://hoverbear.org/consulting/">
                Consulting Services
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/about/">
                Ana, Hoverbear üêª
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/blog/">
                Articles
            </a>&nbsp;
        </li></ul><ul></ul><ul></ul>
</nav>


        <div class="metadata">
            <p class="description">
                    A computer scientist working in open source towards a more hopeful future.
                </p>

            <p class="date">
                    Posted on 2016-01-13, around 3 minutes of reading.
                </p>
        </div>
    </div>
</header>

    <main>
        
    <nav id=toc>
        <ol>
            
            <li>
                <a href="https://hoverbear.org/blog/docker-archlinux/#improvements">Improvements</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/docker-archlinux/#playing-around">Playing Around</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/docker-archlinux/#conclusion">Conclusion</a>
                
            </li>
            
        </ol>
    </nav>

        <p>Back in <a href="/2014/07/14/arch-docker-baseimage/">2014</a> when I was learning about <a rel="noopener" target="_blank" href="https://docker.com">Docker</a> I got around to making a base image for <a rel="noopener" target="_blank" href="http://archlinux.org/">Arch Linux</a>. It was a really fun exploration and I got to know a lot more about how Docker worked from it. I'd highly suggest trying to make your own sometime!</p>
<p>Docker has matured a lot since, and I've enjoyed following it. I took some time this last week to revisit my Arch Linux image and ensure it's still functional. I wasn't surprised when the scripts continued to work just fine, even after two years.</p>
<p>With nothing broken, I knew I only had one choice. <strong>I had to improve it!</strong></p>
<span id="continue-reading"></span>
<blockquote>
<p>Want to get started? See it on the hub <a rel="noopener" target="_blank" href="https://hub.docker.com/r/hoverbear/archlinux/">here</a>, Github <a rel="noopener" target="_blank" href="https://github.com/Hoverbear/docker-archlinux">here</a>, or pull it down with <code>docker run --tty --interactive --rm hoverbear/archlinux /bin/bash</code> and play around.</p>
</blockquote>
<h2 id="improvements">Improvements</h2>
<p>I spent most of my time working on having the <a rel="noopener" target="_blank" href="http://travis-ci.org/">Travis-CI</a> service be able to build and deploy new versions in an automated fashion. This was primarily, for me, a trust thing. I don't feel comfortable running containers I haven't seen the build process for, and you shouldn't either.</p>
<p>While the Docker Hub has &quot;Automated&quot; builds there doesn't seem to be much of a solution for having trusted base images, only images built via a <code>Dockerfile</code>. Perhaps there is a way to scheme and subvert this via the <code>scratch</code> image but I did not find this avenue enjoyable.</p>
<p>Thankfully, Travis did this job stellarly after a few hiccups. The biggest problem was that Travis runs a version of Ubuntu LTS and the <em>normal</em> Arch install process assumes it's happening on a relatively recent Linux, if not Arch itself.</p>
<p>I got around this problem in a slightly dirty way and pinned recent versions of the necessary packages, then upgraded the host into a (slightly terrifying) abomination. I'd like to find a cleaner way of doing this, possibly from inside of a <code>docker</code> container like in the <code>Makefile</code>.</p>
<h2 id="playing-around">Playing Around</h2>
<p>What's a good blog post without some fun examples?</p>
<p><strong>Spawning 10 Arch containers in parallel and having them all pipe to the same file:</strong></p>
<pre style="background-color:#212733;">
<code class="language-bash" data-lang="bash"><span style="color:#ffa759;">for</span><span style="color:#ccc9c2;"> i </span><span style="color:#ffa759;">in </span><span style="color:#ccc9c2;">{1..10}</span><span style="color:#f29e74;">; </span><span style="color:#ffa759;">do </span><span style="color:#ccc9c2;">(</span><span style="color:#ffd580;">docker</span><span style="color:#ccc9c2;"> run</span><span style="color:#ffcc66;"> --rm -v </span><span style="color:#ccc9c2;">$(</span><span style="color:#ffd580;">pwd</span><span style="color:#ccc9c2;">):/here hoverbear/archlinux /bin/bash</span><span style="color:#ffcc66;"> -c </span><span style="color:#bae67e;">&quot;echo $</span><span style="color:#ccc9c2;">i</span><span style="color:#bae67e;"> &gt;&gt; here/checkin&quot; </span><span style="color:#f29e74;">&amp;</span><span style="color:#ccc9c2;">)</span><span style="color:#f29e74;">; </span><span style="color:#ffa759;">done
</span></code></pre>
<p>A few seconds later:</p>
<pre style="background-color:#212733;">
<code class="language-bash" data-lang="bash"><span style="color:#ffd580;">$</span><span style="color:#ccc9c2;"> cat checkin
</span><span style="color:#ffd580;">6
3
4
5
1
8
10
2
7
9
</span></code></pre>
<p><strong>Making an image to build your favorite Rust project:</strong></p>
<pre style="background-color:#212733;">
<code class="language-dockerfile" data-lang="dockerfile"><span style="color:#ffa759;">FROM</span><span style="color:#ccc9c2;"> hoverbear/archlinux
</span><span style="color:#ffa759;">MAINTAINER </span><span style="color:#ccc9c2;">Ana Hobden &lt;ana@hoverbear.org&gt;

</span><span style="font-style:italic;color:#5c6773;"># It&#39;s always a good idea to update Arch, then install deps.
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">pacman -Syu
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">pacman -S git file awk gcc --noconfirm

</span><span style="font-style:italic;color:#5c6773;"># Install Multirust
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">git clone --recursive https://github.com/brson/multirust
</span><span style="color:#ffa759;">WORKDIR </span><span style="color:#ccc9c2;">multirust
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">git submodule update --init
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">./build.sh
</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">./install.sh

</span><span style="color:#ffa759;">RUN </span><span style="color:#ccc9c2;">multirust default </span><span style="color:#bae67e;">&quot;nightly&quot;

</span><span style="font-style:italic;color:#5c6773;"># /source - Should mount the user code.
</span><span style="color:#ffa759;">VOLUME </span><span style="color:#ccc9c2;">[ </span><span style="color:#bae67e;">&quot;/source&quot;</span><span style="color:#ccc9c2;"> ]

</span><span style="font-style:italic;color:#5c6773;"># Change the Workdir to /source
</span><span style="color:#ffa759;">WORKDIR </span><span style="color:#ccc9c2;">/source
</span></code></pre>
<p>Running it inside your favorite project folder:</p>
<pre style="background-color:#212733;">
<code class="language-bash" data-lang="bash"><span style="color:#ffd580;">docker</span><span style="color:#ccc9c2;"> run</span><span style="color:#ffcc66;"> -t -i --rm</span><span style="color:#f29e74;">=</span><span style="color:#ccc9c2;">true</span><span style="color:#ffcc66;"> -v </span><span style="color:#ccc9c2;">$(</span><span style="color:#ffd580;">pwd</span><span style="color:#ccc9c2;">):/source rust cargo build
</span></code></pre>
<p>You can even get this image <a rel="noopener" target="_blank" href="https://hub.docker.com/r/hoverbear/rust/">here</a> if you'd like!</p>
<h2 id="conclusion">Conclusion</h2>
<p>I hope you have a great time using this image and please let me know if there is any way I can make it better!</p>

    </main>
    <footer class="post-footer">
    Connect through &nbsp<a href="mailto:operator@hoverbear.org">operator@hoverbear.org</a>,&nbsp;<a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;<a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
    or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
</footer>
<pre class="artifact"><a id="commit" href="https://github.com/Hoverbear/hoverbear.org/commit/945a4d1eebfff004095a6bc1e260259113b1bac4
">945a4d1eebfff004095a6bc1e260259113b1bac4
</a></pre>
    </body>

</html>
