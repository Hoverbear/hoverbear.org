<!DOCTYPE html>
<html>
    <head>
        <!-- Fun compatability things -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">                  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">
    
        <!-- Information about this site -->
        <title>Init - Configuration
        </title>
        <meta name="description" content="A computer scientist working in open source towards a more hopeful future." />
    
        <!-- Various Twitter related content. -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;bc53a992eae12b8000.jpg"/>
        <meta property='og:image' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;bc53a992eae12b8000.jpg"/>
        <meta name="twitter:site" content="@a_hoverbear"/>
        <meta name="twitter:creator" content="@a_hoverbear"/>
        
        
            <meta name="twitter:title" content="Init - Configuration"/>
            <meta property='og:title' content="Init - Configuration"/>
        

        
            <meta property='og:url' content="https:&#x2F;&#x2F;hoverbear.org&#x2F;blog&#x2F;init-configuration&#x2F;"/>
        

        
            <meta name="twitter:description" content="An initialization system&#x27;s main interface with the user is through it&#x27;s configuration scripts and service files. Let&#x27;s take a look at what this looks like for systemd and OpenRC.
With systemd, daemon configuration is handled by .toml configuration files. With OpenRC, this task is performed by shell scripts.
"/>
            <meta property='og:description' content="An initialization system&#x27;s main interface with the user is through it&#x27;s configuration scripts and service files. Let&#x27;s take a look at what this looks like for systemd and OpenRC.
With systemd, daemon configuration is handled by .toml configuration files. With OpenRC, this task is performed by shell scripts.
"/>
        
    
        <!-- Talk about the homepage and the rss feed. -->
        <link rel="canonical" href="https:&#x2F;&#x2F;hoverbear.org">
        <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">
    
        <!-- Stylesheets are fun -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Delius&family=Fira+Code&family=Noto+Sans&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />
    
        <!-- Katex -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
        <!-- To automatically render math in text elements, include the auto-render extension: -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    </head>
    

    <body>
        
    <div id="hero-wrapper">
    <figure class="enriched ">
        <figcaption>Photo&nbsp;- <a href="https://unsplash.com/photos/-N0cgDSF_MI">Kobi Li</a></figcaption>
        
       
       <img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;fd9cec75a970c38f00.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;bc53a992eae12b8000.jpg 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,set 
                     3840px"
              src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;fd9cec75a970c38f00.jpg"
              alt="Photo" />
    </figure>
</div>

    <header>
    <div class="content">
        <h1 id="main-title"><a id="main-link" href="https:&#x2F;&#x2F;hoverbear.org">
            Init - Configuration
        </a></h1>

        <nav id="tree"><ul><li>
            <a href="https://hoverbear.org/about/">
                Ana, Hoverbear üêª
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/consulting/">
                Consulting Services
            </a>&nbsp;
        </li><li>
            <a href="https://hoverbear.org/blog/">
                Articles
            </a>&nbsp;
        </li></ul><ul></ul><ul></ul>
</nav>


        <div class="metadata">
            <h5 class="description">
                    A computer scientist working in open source towards a more hopeful future.
                </h5>

            <p class="date">
                    Posted on 2014-11-14, around 8 minutes of reading.
                </p>
        </div>
    </div>
</header>

    <main>
        
    <nav id=toc>
        <ol>
            
            <li>
                <a href="https://hoverbear.org/blog/init-configuration/#daemons-and-services">Daemons and services</a>
                
                <ol>
                    
                    <li>
                        <a href="https://hoverbear.org/blog/init-configuration/#dependencies">Dependencies</a>
                    </li>
                    
                    <li>
                        <a href="https://hoverbear.org/blog/init-configuration/#other-files">Other files</a>
                    </li>
                    
                </ol>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/init-configuration/#configuring-init-itself">Configuring Init Itself</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/init-configuration/#thoughts">Thoughts</a>
                
            </li>
            
            <li>
                <a href="https://hoverbear.org/blog/init-configuration/#further-reading">Further Reading</a>
                
            </li>
            
        </ol>
    </nav>

        <p>An initialization system's main interface with the user is through it's configuration scripts and service files. Let's take a look at what this looks like for <code>systemd</code> and OpenRC.</p>
<p>With systemd, daemon configuration is handled by <code>.toml</code> configuration files. With OpenRC, this task is performed by shell scripts.</p>
<span id="continue-reading"></span><h1 id="daemons-and-services">Daemons and services</h1>
<p>systemd stores service files in <code>/etc/systemd/system/</code> (user-provided) or <code>/usr/lib/systemd/system/</code> (package-provided). <code>.service</code> files are used to declare configuration.</p>
<p>OpenRC stores scripts in <code>/etc/init.d/</code>, the scripts are typically standalone, configuration does not require multiple separate files.</p>
<p>Here is the contents of <code>/etc/systemd/system/sshd.service</code> on a Fedora 20 system:</p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Unit</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">Description</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">OpenSSH</span><span class="z-invalid z-illegal z-trailing z-toml"> server daemon</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">After</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">syslog</span><span class="z-invalid z-illegal z-trailing z-toml">.target network.target auditd.service</span>

<span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Service</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">EnvironmentFile</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">/</span><span class="z-invalid z-illegal z-trailing z-toml">etc/sysconfig/sshd</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">ExecStartPre</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">/</span><span class="z-invalid z-illegal z-trailing z-toml">usr/sbin/sshd-keygen</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">ExecStart</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">/</span><span class="z-invalid z-illegal z-trailing z-toml">usr/sbin/sshd -D $OPTIONS</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">ExecReload</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">/</span><span class="z-invalid z-illegal z-trailing z-toml">bin/kill -HUP $MAINPID</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">KillMode</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">process</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">Restart</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">on</span><span class="z-invalid z-illegal z-trailing z-toml">-failure</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">RestartSec</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">42s</span>

<span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Install</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">WantedBy</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">multi</span><span class="z-invalid z-illegal z-trailing z-toml">-user.target</span>
</span></code></pre>
<p>For comparison, this is an excerpt of <code>/etc/init.d/sshd</code> on Funtoo Linux, not the entire file:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">depend</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">use</span></span><span class="z-meta z-function-call z-arguments z-shell"> logger dns</span>
  <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">rc_need</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-keyword z-operator z-assignment z-shell">+</span></span><span class="z-meta z-group z-expansion z-parameter z-shell">set</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>set<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-colon z-shell">:</span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Do nothing, the user has explicitly set rc_need</span><span class="z-comment z-line z-number-sign z-shell">
</span>  <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
    <span class="z-variable z-other z-readwrite z-assignment z-shell">warn_addr</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span><span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
    <span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> x <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>/^ListenAddress/{ print $2 }<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">SSHD_CONFIG</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>/dev/null</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span> <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
      <span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-case z-shell">case</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">x</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-control z-in z-shell">in</span>
        </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">0.0.0.0<span class="z-keyword z-operator z-logical z-shell">|</span>0.0.0.0:<span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-meta z-conditional z-case z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
        </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">::<span class="z-keyword z-operator z-logical z-shell">|</span><span class="z-constant z-character z-escape z-shell">\[</span>::<span class="z-constant z-character z-escape z-shell">\]</span><span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
        </span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-operator z-regexp z-quantifier z-shell">*</span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell"><span class="z-keyword z-control z-conditional z-patterns z-end z-shell">)</span></span></span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"> <span class="z-variable z-other z-readwrite z-assignment z-shell">warn_addr</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">warn_addr</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">x</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> </span><span class="z-meta z-conditional z-case z-clause z-commands z-shell"><span class="z-punctuation z-terminator z-case z-clause z-shell">;;</span></span><span class="z-meta z-conditional z-case z-clause z-patterns z-shell">
      <span class="z-keyword z-control z-conditional z-end z-shell">esac</span></span>
    <span class="z-keyword z-control z-loop z-end z-shell">done</span>
    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-unset z-shell">unset</span></span><span class="z-meta z-function-call z-arguments z-shell"> x</span>
    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">warn_addr</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-keyword z-operator z-assignment z-shell">:+</span></span><span class="z-meta z-group z-expansion z-parameter z-shell">set</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>set<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">need</span></span><span class="z-meta z-function-call z-arguments z-shell"> net</span>
      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ewarn</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>You are binding an interface in ListenAddress statement in your sshd_config!<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ewarn</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>You must add rc_need=<span class="z-constant z-character z-escape z-shell">\&quot;</span>net.FOO<span class="z-constant z-character z-escape z-shell">\&quot;</span> to your /etc/conf.d/sshd<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ewarn</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>where FOO is the interface(s) providing the following address(es):<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ewarn</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">warn_addr</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-unset z-shell">unset</span></span><span class="z-meta z-function-call z-arguments z-shell"> warn_addr</span>
  <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
<span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>

<span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">start</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">checkconfig</span></span> <span class="z-keyword z-operator z-logical z-or z-shell">||</span> <span class="z-meta z-function-call z-shell"><span class="z-keyword z-control z-flow z-return z-shell">return</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1</span>

  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ebegin</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>Starting <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SVCNAME</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">start-stop-daemon</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>start</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>exec</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SSHD_BINARY</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">      --</span>pidfile</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SSHD_PIDFILE</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-keyword z-operator z-end-of-options z-shell">      --</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SSHD_OPTS</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">eend</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">?</span></span></span>
<span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>

<span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">stop</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
  <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">RC_CMD</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>restart<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span> <span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">checkconfig</span></span> <span class="z-keyword z-operator z-logical z-or z-shell">||</span> <span class="z-meta z-function-call z-shell"><span class="z-keyword z-control z-flow z-return z-shell">return</span></span><span class="z-meta z-function-call z-arguments z-shell"> 1</span>
  <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>

  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ebegin</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>Stopping <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SVCNAME</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">start-stop-daemon</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>stop</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>exec</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SSHD_BINARY</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">      --</span>pidfile</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">SSHD_PIDFILE</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>quiet</span></span>
  <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">eend</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">?</span></span></span>
<span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></code></pre>
<p>An important distinction to note is that while systemd's configuration is <strong>declarative</strong>, OpenRC's configuration is <strong>programmatic</strong>. The decision to use a declarative method was explained in <a rel="noopener" target="_blank" href="http://0pointer.de/blog/projects/systemd.html">this</a> article under the &quot;Keeping the First User PID Small&quot; heading.</p>
<blockquote>
<p>Shell is fast and shell is slow. It is fast to hack, but slow in execution. The classic sysvinit boot logic is modelled around shell scripts.</p>
</blockquote>
<p>One of systemd's main goals, at least in regards to services, is to start them <strong>fast</strong>, and for this reason they are willing to sacrifice some flexibility. Due to successful deployments of systemd in Arch Linux and Fedora (among others), this idea has been proven feasible.</p>
<p>For many services, a full blown shell script is not necessary. For example, with OpenRC's <code>sshd</code> script the <code>start</code> and <code>stop</code> jobs really only check the configuration of the service (<code>checkconfig</code> is defined elsewhere in the file) and then invoke <code>start-stop-daemon</code>. It's possible to simply call a shell script from a systemd service, but this forces the use of multiple files, and results in a loss of the speed gained from not utilizing the shell.</p>
<h2 id="dependencies">Dependencies</h2>
<p>In systemd dependencies are handled via the declarations <code>Wants</code>, <code>Requires</code>, and <code>After</code> in the <code>[Unit]</code> section of the <code>.service</code>. For more info visit <a rel="noopener" target="_blank" href="https://wiki.archlinux.org/index.php/systemd#Handling_dependencies">Arch Linux's SystemD Dependencies Section</a>. For example:</p>
<p><strong>/etc/systemd/system/A.service</strong></p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Unit</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> Optionally depends on `C` and `D`.</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">Wants</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">C</span><span class="z-invalid z-illegal z-trailing z-toml">.service D.service</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> Start after `D`, but concurrently with `C`</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">After</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">D</span><span class="z-invalid z-illegal z-trailing z-toml">.service</span>
</span></code></pre>
<p><strong>/etc/systemd/system/B.service</strong></p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Unit</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> Strictly depend on A and Networking.</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">Requires</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">A</span><span class="z-invalid z-illegal z-trailing z-toml">.service Networking.target</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span> Start after `A`, but concurrently with `Networking`</span>
<span class="z-meta z-tag z-key z-toml"><span class="z-entity z-name z-tag z-toml">After</span></span><span class="z-punctuation z-definition z-key-value z-toml">=</span><span class="z-invalid z-illegal z-value z-toml">A</span><span class="z-invalid z-illegal z-trailing z-toml">.service</span>
</span></code></pre>
<p>It's rather fascinating that <code>Requires</code> and <code>Wants</code> do not imply <code>After</code> for their specified services. It does make sense though, many services do not immediately require their attached services.</p>
<p>For OpenRC, dependencies are handled by the <code>depend</code> function of the script. For more info visit <a rel="noopener" target="_blank" href="http://www.funtoo.org/Package:OpenRC">The Funtoo OpenRC Page</a>.</p>
<p><strong>/etc/init.d/nginx</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">depend</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
	<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">need</span></span><span class="z-meta z-function-call z-arguments z-shell"> net</span>
	<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">use</span></span><span class="z-meta z-function-call z-arguments z-shell"> dns logger netmount</span>
<span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></code></pre>
<p>There are five options:</p>
<ul>
<li><code>need</code> introduces a hard dependency (like <code>Require</code>)</li>
<li><code>use</code> is a soft dependency which will only invoke if the depended upon service is also on the same runlevel.</li>
<li><code>after</code> functions like <code>After</code> in system, making sure this service starts after the specified one.</li>
<li><code>provide</code> can be used to allow the service to 'stand in' for another. For example, MariaDB and MySQL could both <code>provide sql</code>.</li>
<li><code>keyword</code> allows for overrides. Check the documentation for more on this.</li>
</ul>
<h2 id="other-files">Other files</h2>
<p>Systemd uses a number of extra file types. Some examples are:</p>
<ul>
<li><code>.wants</code>, a folder with symlinks to services that are a needed by a target. For example, <code>/usr/lib/systemd/system/multi-user.target</code> has a cooresponding folder <code>/usr/lib/systemd/system/multi-user.target.wants</code> with symlinks to service files like <code>systemd-logind.service</code>, and <code>systemd-user-sessions.service</code> on CentOS 7.</li>
<li><code>.socket</code>, denotes a <a rel="noopener" target="_blank" href="http://www.freedesktop.org/software/systemd/man/systemd.socket.html">socket activated</a> configuration. It's possible to set up certain services in systemd to not start until their socket is activated on the system.</li>
<li><code>.timer</code>, denotes a <a rel="noopener" target="_blank" href="http://www.freedesktop.org/software/systemd/man/systemd.timer.html">timer based</a> activation. This fulfills some of the same roles as programs like <code>vixiecron</code> and <code>fcron</code>.</li>
</ul>
<p>OpenRC allows for files in <code>/etc/conf.d</code> to be sourced for scripts of the same name in <code>/etc/init.d</code>. The advantage of this is that most scripts in <code>/etc/init.d</code> won't need to be modified (and thus can be updated safely). This is a collary to the <a rel="noopener" target="_blank" href="http://12factor.net/config">Store config in the environment</a> section of the 12factor methodology.</p>
<blockquote>
<p>Encourage the separation of configuration and runtime.</p>
</blockquote>
<p>Here we can see the origin of the <code>${SSHD_OPTS}</code> from the earlier example of <code>/etc/init.d/sshd</code>:</p>
<p><strong>/etc/conf.d/sshd</strong>:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> /etc/conf.d/sshd: config file for /etc/init.d/sshd</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Where is your sshd_config file stored?</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-variable z-other z-readwrite z-assignment z-shell">SSHD_CONFDIR</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/ssh<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>

<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Any random options you want to pass to sshd.</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> See the sshd(8) manpage for more info.</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-variable z-other z-readwrite z-assignment z-shell">SSHD_OPTS</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>

<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Pid file to use (needs to be absolute path).</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">SSHD_PIDFILE=&quot;/var/run/sshd.pid&quot;</span><span class="z-comment z-line z-number-sign z-shell">
</span>

<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Path to the sshd binary (needs to be absolute path).</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">SSHD_BINARY=&quot;/usr/sbin/sshd&quot;</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre>
<h1 id="configuring-init-itself">Configuring Init Itself</h1>
<p>OpenRC is configured the same way as most traditional Linux/BSD services are configured. The default configuration on Funtoo is well commented and usually self-explanatory, even including gotchas in their notes. There are a few knobs to tweak based on user preferences.</p>
<p><strong>/etc/rc.conf</strong>:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Set to &quot;YES&quot; if you want the rc system to try and start services</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> in parallel for a slight speed improvement. When running in parallel we</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> prefix the service output with its name as the output will get</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> jumbled up.</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> WARNING: whilst we have improved parallel, it can still potentially lock</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> the boot process. Don&#39;t file bugs about this unless you can supply</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> patches that fix it without breaking other things!</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-variable z-other z-readwrite z-assignment z-shell">rc_parallel</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>YES<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>

<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> rc_logger launches a logging daemon to log the entire rc process to</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> /var/log/rc.log</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> NOTE: Linux systems require the devfs service to be started before</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> logging can take place and as such cannot log the sysinit runlevel.</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-variable z-other z-readwrite z-assignment z-shell">rc_logger</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>YES<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>systemd's configuration is similarly accessible in <code>/etc/systemd/*.conf</code>, from there it's possible to set things like the default CPU limits for processes and other things.</p>
<p><strong>/etc/systemd/system.conf</strong>:</p>
<pre data-lang="toml" class="language-toml z-code"><code class="language-toml" data-lang="toml"><span class="z-source z-toml"><span class="z-punctuation z-definition z-table z-begin z-toml">[</span><span class="z-meta z-tag z-table z-toml"><span class="z-entity z-name z-table z-toml">Manager</span></span><span class="z-punctuation z-definition z-table z-end z-toml">]</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>CPUAffinity=1 2</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultStandardOutput=journal</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultStandardError=inherit</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>JoinControllers=cpu,cpuacct net_cls,net_prio</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>RuntimeWatchdogSec=0</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>ShutdownWatchdogSec=10min</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>CapabilityBoundingSet=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>TimerSlackNSec=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultTimeoutStartSec=90s</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultTimeoutStopSec=90s</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultRestartSec=100ms</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultStartLimitInterval=10s</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultStartLimitBurst=5</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultEnvironment=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultLimitCPU=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultLimitFSIZE=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultLimitDATA=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultLimitSTACK=</span>
<span class="z-comment z-line z-number-sign z-toml"><span class="z-punctuation z-definition z-comment z-toml">#</span>DefaultLimitCORE=</span>
</span></code></pre>
<p><code>journald.conf</code> offers configuration options on the journal, or logger.</p>
<h1 id="thoughts">Thoughts</h1>
<p>The declarative model of systemd emulates a &quot;batteries included&quot; model. It relies on integrated, homogeneous functionality in order to gain performance boosts and an encompassing feature set. Over the past few years the project has had a growing scope in the userland, as evidenced by the existance of things like the <code>logind.conf</code> and <code>journald.conf</code>, both of which used to be jobs outside of the initialization system. The regular syntax of all of these configurations does offer a boon, but at the cost of modularity and with greater complexity.</p>
<p>OpenRC's sysvinit based startup shows it's age, but the system's lack of opinionation offers huge benefits. With OpenRC, there is no persistent daemon, though integration with supervision tools like <code>s6</code> and <code>monit</code> exist. OpenRC also plays nice with <code>*cron</code>. Keeping itself in a limited scope, and maintaining the &quot;Do one thing and do it well&quot; philosophy that gave rise to the UNIX ecosystem. It has worn it's age well, however it's reliance on old assumptions about the lifecycle of a system boot limits it's capabilities.</p>
<h1 id="further-reading">Further Reading</h1>
<ul>
<li><a rel="noopener" target="_blank" href="http://www.funtoo.org/Package:OpenRC">OpenRC Dependencies</a></li>
<li><a rel="noopener" target="_blank" href="http://0pointer.de/blog/projects/systemd.html">Rethinking PID 1</a></li>
<li><a rel="noopener" target="_blank" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Targets.html">Red Hat: Working with systemd Targets</a></li>
<li><a rel="noopener" target="_blank" href="http://www.freedesktop.org/software/systemd/man/systemd.target.html">Systemd Target</a></li>
<li><a rel="noopener" target="_blank" href="http://0pointer.de/blog/projects/systemd-update.html">Systemd status update 1</a></li>
<li><a rel="noopener" target="_blank" href="http://0pointer.de/blog/projects/systemd-update-2.html">Systemd status update 2</a></li>
<li><a rel="noopener" target="_blank" href="http://0pointer.de/blog/projects/systemd-update-3.html">Systemd status update 3</a></li>
<li><a rel="noopener" target="_blank" href="http://wiki.gentoo.org/wiki/Comparison_of_init_systems">Comparison of init Systems</a></li>
<li><a rel="noopener" target="_blank" href="http://skarnet.org/software/s6/why.html">s6 why?</a></li>
<li><a rel="noopener" target="_blank" href="https://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=2&amp;chap=4#doc_chap5">Initscripts (Gentoo Handbook)</a></li>
</ul>

    </main>
    <footer class="post-footer">
    Connect through &nbsp<a href="mailto:operator@hoverbear.org">operator@hoverbear.org</a>,&nbsp;<a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;<a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
    or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
</footer>
<pre class="artifact"><a id="commit" href="https://github.com/Hoverbear/hoverbear.org/commit/b3a59834f9cfcedb3ba64d82e709f0d0935ab894
">b3a59834f9cfcedb3ba64d82e709f0d0935ab894
</a></pre>
    </body>

</html>
