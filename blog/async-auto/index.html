<!DOCTYPE html>
<html>
    <head>
        <!-- Fun compatability things -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">                  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <link rel="shortcut icon" href="https:&#x2F;&#x2F;hoverbear.org/images/favicon.ico">
    
        <!-- Information about this site -->
        <title>Async Auto
        </title>
        <meta name="description" content="A computer scientist working in open source towards a more hopeful future." />
    
        <!-- Various Twitter related content. -->
        <meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;a157fd2afbc5f18800.jpg">
        <meta name="twitter:site" content="@a_hoverbear">
        <meta name="twitter:creator" content="@a_hoverbear">
        
            <meta name="twitter:title" content="Async Auto">
        
        
            <meta name="twitter:description" content="I&#x27;ve been exploring the handy async over the last few days in the lab. One of my projects is a MongoDB API Adapter in Node.js and I was pleased by a novel way of handling control flow.
async.auto() is a function offered by the libary which allows you to declare a set of tasks and their dependencies, then the library determines the best way to compose the initialization.
">
        
    
        <!-- Talk about the homepage and the rss feed. -->
        <link rel="canonical" href="https:&#x2F;&#x2F;hoverbear.org">
        <link rel="alternate" type="application/rss+xml" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">
    
        <!-- Stylesheets are fun -->
        <link rel="stylesheet" href="https:&#x2F;&#x2F;hoverbear.org/font/fira_code/fira_code.css">
        <link rel="stylesheet" href="https:&#x2F;&#x2F;hoverbear.org/font/fira/fira.css">
        <link rel="stylesheet" type="text/css" media="screen" href="https:&#x2F;&#x2F;hoverbear.org/main.css" />
    
        <!-- Katex -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
        <!-- To automatically render math in text elements, include the auto-render extension: -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    </head>
    

    <body>
        <header><div id="hero-wrapper">
        <figure class="enriched ">
        <figcaption>Photo&nbsp;- <a href="https://unsplash.com/photos/-N0cgDSF_MI">Kobi Li</a></figcaption>
        <img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;a3aed6e7b2f3210400.jpg 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;a157fd2afbc5f18800.jpg 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;2851c84fd6c5141000.jpg"
              alt="Photo" />
    </figure>
    </div>
    <div class="hero-wrapper-content">

        <h1><a href="https:&#x2F;&#x2F;hoverbear.org">Async Auto</a></h1>


        <nav id="tree"><ul><li>
                                <a href="https://hoverbear.org/about/">
                                    About
                                </a>&nbsp;
                            </li><li>
                                <a href="https://hoverbear.org/consulting/">
                                    Consulting
                                </a>&nbsp;
                            </li><li>
                                <a href="https://hoverbear.org/blog/">
                                    Blog
                                </a>&nbsp;
                            </li></ul><ul></ul><ul></ul>
        </nav>

        <div class="metadata">
            <p class="description">
                    A computer scientist working in open source towards a more hopeful future.
                </p>

            <p class="date">
                    Posted on 2014-06-05, around 2 minutes of reading.
                </p>
        </div>

    </div>
</header>

        <main>
            <article>
                
                
    <p>I've been exploring the handy <a href="https://github.com/caolan/async"><code>async</code></a> over the last few days in the lab. One of my projects is a MongoDB API Adapter in Node.js and I was pleased by a novel way of handling control flow.</p>
<p><a href="https://github.com/caolan/async#autotasks-callback"><code>async.auto()</code></a> is a function offered by the libary which allows you to declare a set of tasks and their dependencies, then the library determines the best way to compose the initialization.</p>
<span id="continue-reading"></span>
<p>Consider the following dependency graph:</p>
<figure class="enriched ">
        <figcaption>Graph</figcaption>
        <img srcset="
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;fe2bb57f76e4b24d00.png 1920w,
              https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;20daae5d72b7f42d00.png 3840w
              "
              sizes="
                     (max-width: 1200px) 1200px,
                     (max-width: 1800px) 1800px,
                     3840px"
              src="https:&#x2F;&#x2F;hoverbear.org&#x2F;processed_images&#x2F;607cf87fa327b8a200.png"
              alt="Graph" />
    </figure>
<p>With <code>async</code> this could be modelled like so:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">init</span><span style="color:#c0c5ce;">() {
	</span><span style="color:#bf616a;">async</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">auto</span><span style="color:#c0c5ce;">({
		dbConn: </span><span style="color:#bf616a;">dbConn</span><span style="color:#c0c5ce;">,
		schemas: [ &#39;</span><span style="color:#a3be8c;">dbConn</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">schemas </span><span style="color:#c0c5ce;">],
		http: </span><span style="color:#bf616a;">http</span><span style="color:#c0c5ce;">,
		httpMiddleware: [ &#39;</span><span style="color:#a3be8c;">http</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">httpMiddleware </span><span style="color:#c0c5ce;">],
		routes: [ &#39;</span><span style="color:#a3be8c;">http</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">schemas</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#bf616a;">routes </span><span style="color:#c0c5ce;">]
	}, </span><span style="color:#bf616a;">listen</span><span style="color:#c0c5ce;">);

	</span><span style="color:#65737e;">// Definitions of functions below.
</span><span style="color:#c0c5ce;">}());
</span></code></pre>
<p>The first parameter of the function is an object of tasks. They follow the format <code>taskName: function</code> or <code>taskName: [dependencies, function]</code>. Tasks with dependencies will only start when those have been resolved.</p>
<p>So async helps with the handling of dependencies, but can we handle dependant state?</p>
<p>For example, <code>dbConn</code> produces a <code>connection</code> variable, and <code>schemas</code> consumes it. The two functions look like this:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">dbConn</span><span style="color:#c0c5ce;">(callback) {
	</span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">connection </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">db</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">connect</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">someString</span><span style="color:#c0c5ce;">).connection
	</span><span style="color:#bf616a;">connection</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">on</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">success</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">() {
		</span><span style="color:#65737e;">// Return `connection` into the `results`
		</span><span style="color:#bf616a;">callback</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">connection</span><span style="color:#c0c5ce;">);
	});
	</span><span style="color:#bf616a;">connection</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">on</span><span style="color:#c0c5ce;">(&#39;</span><span style="color:#a3be8c;">error</span><span style="color:#c0c5ce;">&#39;, </span><span style="color:#b48ead;">function </span><span style="color:#c0c5ce;">(error) {
		</span><span style="color:#bf616a;">callback</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">error</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">);
	});
}

</span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">schemas</span><span style="color:#c0c5ce;">(callback, results) {
	</span><span style="color:#65737e;">// Do a bunch of stuff.
	// results.dbConn has the connection.
	</span><span style="color:#bf616a;">callback</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">null</span><span style="color:#c0c5ce;">);
}
</span></code></pre>
<p>The result values of any task which another depends on are populated into the <code>results</code> parameter.</p>
<p>Finally, the <code>listen</code> function accepts a final <code>(error, results)</code>. Note it's called as soon as <strong>any</strong> task returns an error, so always make sure to handle errors. Finally, <code>results</code> will have all of the return values of the tasks which were composed.</p>
<p>This provides a compelling way to handle composability and dependencies without having to deal with complex callback changes. Functions will be invoked as their dependencies are resolved, and it's easy to add or remove dependencies, changing what's available in <code>results</code>.</p>
<p>Give this pattern a try, it's especially useful when combined with other functions available in <code>async</code>, like <a href="https://github.com/caolan/async#seq"><code>async.seq</code></a>.</p>


            </article>
        </main>
        
        <footer class="post-footer">
    <div class="content">
        <h4><a href=/>← Back to top of index</a></h4>
    
        <h4>By Ana Hobden</h4><p>
            Connect through&nbsp;<a href="https://github.com/hoverbear">@hoverbear</a> on Github,&nbsp;<a href="https://twitter.com/a_hoverbear">@a_hoverbear</a> on Twitter,</a>&nbsp;
            or track via <a class="subscribe" href="https:&#x2F;&#x2F;hoverbear.org/rss.xml">RSS Feed</a>.
        </p><p>Built from <a href="https://github.com/Hoverbear/hoverbear.org/commit/99a49d3ea9d37ea941d5dcb4fc646074ca33cc80
"><code>99a49d3ea9d37ea941d5dcb4fc646074ca33cc80
</code></a></p>
    </div>
</footer>
            
    </body>

</html>
